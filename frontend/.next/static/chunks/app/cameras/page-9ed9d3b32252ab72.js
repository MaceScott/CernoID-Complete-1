(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13],{17282:function(e,t,i){Promise.resolve().then(i.bind(i,52129))},52129:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return b}});var r=i(3827),s=i(64090),n=i(54272),a=i(66910),o=i(4598),l=i(29835),c=i(61760),u=i(60205),d=i(83894),h=i(82508),f=i(10470),g=i(43206),x=i(60036),p=i(2542),m=i(12781),y=i(47794),j=i(2888),w=i(25166);function v(){let{user:e}=(0,j.aC)(),[t,i]=(0,s.useState)([]),[v,Z]=(0,s.useState)(!0),[b,E]=(0,s.useState)(null),[C,L]=(0,s.useState)("all"),[P,S]=(0,s.useState)(null),k=(0,s.useRef)({}),O=(0,s.useRef)(null);(0,s.useEffect)(()=>(A(),()=>{t.forEach(e=>{e.stream&&e.stream.getTracks().forEach(e=>e.stop())})}),[]),(0,s.useEffect)(()=>{t.forEach(e=>{let t=k.current[e.id];t&&e.stream&&(t.srcObject=e.stream)})},[t]),(0,s.useEffect)(()=>{O.current&&(null==P?void 0:P.stream)&&(O.current.srcObject=P.stream)},[P]);let A=async()=>{try{Z(!0);let e=[{id:"1",name:"Main Entrance",type:"facial",status:"online",stream:null},{id:"2",name:"Side Door",type:"security",status:"online",stream:null},{id:"3",name:"Reception",type:"facial",status:"online",stream:null},{id:"4",name:"Parking Lot",type:"security",status:"offline",stream:null}];for(let t of(i(e),e))if("online"===t.status)try{let e=await navigator.mediaDevices.getUserMedia({video:!0});i(i=>i.map(i=>i.id===t.id?{...i,stream:e}:i))}catch(e){}}catch(e){E("Failed to fetch cameras")}finally{Z(!1)}},T=t.filter(e=>"all"===C||e.type===C);return(0,r.jsx)(w.l,{title:"Multi-Camera View",children:(0,r.jsxs)(o.Z,{maxWidth:"xl",children:[(0,r.jsxs)(n.Z,{sx:{mt:4},children:[(0,r.jsxs)(n.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(l.Z,{variant:"h4",component:"h1",children:"Camera Feeds"}),(0,r.jsxs)(c.Z,{value:C,exclusive:!0,onChange:(e,t)=>t&&L(t),size:"small",children:[(0,r.jsx)(u.Z,{value:"all",children:"All Cameras"}),(0,r.jsx)(u.Z,{value:"facial",children:"Facial Recognition"}),(0,r.jsx)(u.Z,{value:"security",children:"Security Only"})]})]}),v?(0,r.jsx)(n.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:(0,r.jsx)(a.Z,{})}):b?(0,r.jsx)(d.Z,{severity:"error",sx:{mb:3},children:b}):(0,r.jsx)(h.ZP,{container:!0,spacing:3,children:T.map(e=>(0,r.jsx)(h.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,r.jsxs)(f.Z,{sx:{p:2,position:"relative","&:hover .camera-controls":{opacity:1}},children:[(0,r.jsxs)(n.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,r.jsx)(l.Z,{variant:"h6",children:e.name}),"online"===e.status?(0,r.jsx)(p.Z,{color:"success"}):(0,r.jsx)(m.Z,{color:"error"})]}),(0,r.jsx)(n.Z,{sx:{width:"100%",height:200,bgcolor:"black",position:"relative"},children:"online"===e.status?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("video",{ref:t=>{k.current[e.id]=t},autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,r.jsx)(n.Z,{className:"camera-controls",sx:{position:"absolute",top:0,right:0,p:1,opacity:0,transition:"opacity 0.2s",bgcolor:"rgba(0,0,0,0.5)"},children:(0,r.jsx)(g.Z,{size:"small",sx:{color:"white"},onClick:()=>S(e),children:(0,r.jsx)(y.Z,{})})})]}):(0,r.jsx)(n.Z,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(l.Z,{color:"error",children:"Camera Offline"})})})]})},e.id))})]}),(0,r.jsx)(x.Z,{fullScreen:!0,open:!!P,onClose:()=>S(null),children:P&&(0,r.jsxs)(n.Z,{sx:{height:"100%",bgcolor:"black"},children:[(0,r.jsxs)(n.Z,{sx:{position:"absolute",top:0,left:0,right:0,p:2,bgcolor:"rgba(0,0,0,0.5)",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(l.Z,{variant:"h6",children:P.name}),(0,r.jsx)(g.Z,{color:"inherit",onClick:()=>S(null),children:(0,r.jsx)(y.Z,{})})]}),(0,r.jsx)("video",{ref:O,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"contain"}})]})})]})})}var Z=i(47907);function b(){let{user:e,isLoading:t}=(0,j.aC)(),i=(0,Z.useRouter)();return((0,s.useEffect)(()=>{t||e||i.push("/login")},[e,t,i]),t||!e)?(0,r.jsx)(n.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,r.jsx)(a.Z,{})}):(0,r.jsx)(v,{})}},25166:function(e,t,i){"use strict";i.d(t,{l:function(){return l}});var r=i(3827),s=i(4598),n=i(10470),a=i(29835),o=i(54272);function l(e){let{children:t,title:i}=e;return(0,r.jsx)(s.Z,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,r.jsxs)(n.Z,{sx:{p:4},children:[(0,r.jsx)(a.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:i}),(0,r.jsx)(o.Z,{sx:{mt:3},children:t})]})})}},2888:function(e,t,i){"use strict";i.d(t,{aC:function(){return n}});var r=i(64090),s=i(84586);function n(){let e=(0,r.useContext)(s.V);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}i(47907)},84586:function(e,t,i){"use strict";i.d(t,{H:function(){return o},V:function(){return a}});var r=i(3827),s=i(64090),n=i(47907);let a=(0,s.createContext)(null);function o(e){let{children:t}=e,i=(0,n.useRouter)(),[o,l]=(0,s.useState)({user:null,isAuthenticated:!1,isLoading:!0,error:null}),c=e=>{l(t=>({...t,error:e}))},u=async e=>{try{c(null),l(e=>({...e,isLoading:!0})),l(t=>({...t,user:e,isAuthenticated:!0,isLoading:!1})),i.push("/dashboard")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},d=async e=>{try{var t;c(null),l(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/login/face",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({faceData:e})});if(!r.ok)throw Error("Face recognition login failed");let s=await r.json();if(!s.success||!(null===(t=s.data)||void 0===t?void 0:t.user))throw Error(s.error||"Face recognition login failed");l(e=>({...e,user:s.data.user,isAuthenticated:!0,isLoading:!1})),i.push("/dashboard")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Face recognition login failed"})),e}},h=async e=>{try{var t;c(null),l(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!r.ok)throw Error("Registration failed");let s=await r.json();if(!s.success||!(null===(t=s.data)||void 0===t?void 0:t.user))throw Error(s.error||"Registration failed");l(e=>({...e,user:s.data.user,isAuthenticated:!0,isLoading:!1})),i.push("/dashboard")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"})),e}},f=async()=>{try{c(null),l(e=>({...e,isLoading:!0})),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),l({user:null,isAuthenticated:!1,isLoading:!1,error:null}),i.push("/login")}catch(e){l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Logout failed"}))}},g=async e=>{try{c(null),l(e=>({...e,isLoading:!0}));let t=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});if(!t.ok)throw Error("Password reset failed");let i=await t.json();if(!i.success)throw Error(i.error||"Password reset failed");l(e=>({...e,isLoading:!1}))}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password reset failed"})),e}},x=async(e,t,r)=>{try{c(null),l(e=>({...e,isLoading:!0}));let s=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:t,confirmPassword:r})});if(!s.ok)throw Error("Password update failed");let n=await s.json();if(!n.success)throw Error(n.error||"Password update failed");l(e=>({...e,isLoading:!1})),i.push("/login")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password update failed"})),e}};(0,s.useEffect)(()=>{!async function(){try{var e;let t=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(!t.ok)throw Error("Authentication check failed");let i=await t.json();i.success&&(null===(e=i.data)||void 0===e?void 0:e.user)?l({user:i.data.user,isAuthenticated:!0,isLoading:!1,error:null}):l({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(e){l({user:null,isAuthenticated:!1,isLoading:!1,error:e instanceof Error?e.message:"Authentication check failed"})}}()},[]);let p={...o,login:u,loginWithFace:d,register:h,logout:f,resetPassword:g,updatePassword:x};return(0,r.jsx)(a.Provider,{value:p,children:t})}}},function(e){e.O(0,[463,26,756,355,585,258,894,508,62,971,69,744],function(){return e(e.s=17282)}),_N_E=e.O()}]);