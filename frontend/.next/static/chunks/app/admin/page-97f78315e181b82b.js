(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{20309:function(e,n,a){Promise.resolve().then(a.bind(a,56966))},56966:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return D}});var i=a(3827),t=a(64090),r=a(54272),s=a(66910),l=a(4598),o=a(83894),d=a(29835),c=a(68886),u=a(16840),h=a(6285),x=a(10470),m=a(90144),j=a(21551),f=a(88433),p=a(93070),g=a(43206),Z=a(60036),v=a(40512),y=a(67147),w=a(72921),C=a(41848),b=a(9186),S=a(12148),E=a(24293),L=a(89969),A=a(95749),k=a(44466),P=a(57674),O=a(26009),F=a(43260),R=a(89900),T=a(2888),N=a(25166);function W(){var e,n,a,W,U,D,I,_,J,V;let{user:B}=(0,T.aC)(),[q,z]=(0,t.useState)(0),[G,H]=(0,t.useState)([]),[M,K]=(0,t.useState)([]),[Q,X]=(0,t.useState)([]),[Y,$]=(0,t.useState)(!0),[ee,en]=(0,t.useState)(null),[ea,ei]=(0,t.useState)({open:!1,user:null}),[et,er]=(0,t.useState)({open:!1,camera:null});(0,t.useEffect)(()=>{if((null==B?void 0:B.role)!=="admin"){en("Access denied. Admin privileges required.");return}es()},[B]);let es=async()=>{try{$(!0),H([{id:"1",name:"Admin User",email:"admin@example.com",role:"admin",status:"active"},{id:"2",name:"Regular User",email:"user@example.com",role:"user",status:"active"},{id:"3",name:"Viewer",email:"viewer@example.com",role:"viewer",status:"suspended"}]),K([{id:"1",name:"Main Entrance",location:"Front Door",type:"facial",enabled:!0,settings:{resolution:"1080p",frameRate:30,recording:!0}},{id:"2",name:"Parking Lot",location:"Exterior",type:"security",enabled:!0,settings:{resolution:"720p",frameRate:24,recording:!0}}]),X([{id:"1",timestamp:new Date().toISOString(),type:"login",user:"admin@example.com",action:"Login successful",details:"IP: 192.168.1.1"},{id:"2",timestamp:new Date().toISOString(),type:"access",user:"user@example.com",action:"Access denied",details:"Attempted to access admin page"}])}catch(e){en("Failed to fetch data")}finally{$(!1)}},el=async e=>{try{e.id?H(n=>n.map(n=>n.id===e.id?{...n,...e}:n)):H(n=>[...n,{...e,id:Date.now().toString()}]),ei({open:!1,user:null})}catch(e){en("Failed to save user")}},eo=async e=>{try{e.id?K(n=>n.map(n=>n.id===e.id?{...n,...e}:n)):K(n=>[...n,{...e,id:Date.now().toString()}]),er({open:!1,camera:null})}catch(e){en("Failed to save camera")}},ed=async e=>{try{H(n=>n.filter(n=>n.id!==e))}catch(e){en("Failed to delete user")}},ec=async e=>{try{K(n=>n.filter(n=>n.id!==e))}catch(e){en("Failed to delete camera")}};return ee?(0,i.jsx)(N.l,{title:"Administration",children:(0,i.jsx)(l.Z,{children:(0,i.jsx)(o.Z,{severity:"error",sx:{mt:4},children:ee})})}):(0,i.jsx)(N.l,{title:"Administration",children:(0,i.jsxs)(l.Z,{maxWidth:"xl",children:[(0,i.jsxs)(r.Z,{sx:{mt:4},children:[(0,i.jsx)(d.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"System Administration"}),(0,i.jsx)(r.Z,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,i.jsxs)(c.Z,{value:q,onChange:(e,n)=>z(n),children:[(0,i.jsx)(u.Z,{label:"Users"}),(0,i.jsx)(u.Z,{label:"Cameras"}),(0,i.jsx)(u.Z,{label:"System Logs"})]})}),Y?(0,i.jsx)(r.Z,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,i.jsx)(s.Z,{})}):(0,i.jsxs)(i.Fragment,{children:[0===q&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(r.Z,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:(0,i.jsx)(h.Z,{variant:"contained",startIcon:(0,i.jsx)(P.Z,{}),onClick:()=>ei({open:!0,user:{}}),children:"Add User"})}),(0,i.jsx)(x.Z,{children:(0,i.jsx)(m.Z,{children:G.map(e=>(0,i.jsxs)(j.ZP,{children:[(0,i.jsx)(f.Z,{primary:e.name,secondary:"".concat(e.email," - ").concat(e.role," (").concat(e.status,")")}),(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(g.Z,{edge:"end",onClick:()=>ei({open:!0,user:e}),children:(0,i.jsx)(O.Z,{})}),(0,i.jsx)(g.Z,{edge:"end",onClick:()=>ed(e.id),children:(0,i.jsx)(F.Z,{})})]})]},e.id))})})]}),1===q&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(r.Z,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:(0,i.jsx)(h.Z,{variant:"contained",startIcon:(0,i.jsx)(P.Z,{}),onClick:()=>er({open:!0,camera:{}}),children:"Add Camera"})}),(0,i.jsx)(x.Z,{children:(0,i.jsx)(m.Z,{children:M.map(e=>(0,i.jsxs)(j.ZP,{children:[(0,i.jsx)(f.Z,{primary:e.name,secondary:"".concat(e.location," - ").concat(e.type," (").concat(e.enabled?"Enabled":"Disabled",")")}),(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(g.Z,{edge:"end",onClick:()=>er({open:!0,camera:e}),children:(0,i.jsx)(O.Z,{})}),(0,i.jsx)(g.Z,{edge:"end",onClick:()=>ec(e.id),children:(0,i.jsx)(F.Z,{})})]})]},e.id))})})]}),2===q&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(r.Z,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:(0,i.jsx)(h.Z,{variant:"outlined",startIcon:(0,i.jsx)(R.Z,{}),onClick:es,children:"Refresh Logs"})}),(0,i.jsx)(x.Z,{children:(0,i.jsx)(m.Z,{children:Q.map(e=>(0,i.jsx)(j.ZP,{children:(0,i.jsx)(f.Z,{primary:"".concat(e.type.toUpperCase(),": ").concat(e.action),secondary:"".concat(new Date(e.timestamp).toLocaleString()," - ").concat(e.user," - ").concat(e.details)})},e.id))})})]})]})]}),(0,i.jsxs)(Z.Z,{open:ea.open,onClose:()=>ei({open:!1,user:null}),children:[(0,i.jsx)(v.Z,{children:(null===(e=ea.user)||void 0===e?void 0:e.id)?"Edit User":"Add User"}),(0,i.jsx)(y.Z,{children:(0,i.jsxs)(r.Z,{sx:{pt:2},children:[(0,i.jsx)(w.Z,{fullWidth:!0,label:"Name",value:(null===(n=ea.user)||void 0===n?void 0:n.name)||"",onChange:e=>ei(n=>({...n,user:{...n.user,name:e.target.value}})),sx:{mb:2}}),(0,i.jsx)(w.Z,{fullWidth:!0,label:"Email",type:"email",value:(null===(a=ea.user)||void 0===a?void 0:a.email)||"",onChange:e=>ei(n=>({...n,user:{...n.user,email:e.target.value}})),sx:{mb:2}}),(0,i.jsxs)(C.Z,{fullWidth:!0,sx:{mb:2},children:[(0,i.jsx)(b.Z,{children:"Role"}),(0,i.jsxs)(S.Z,{value:(null===(W=ea.user)||void 0===W?void 0:W.role)||"",onChange:e=>ei(n=>({...n,user:{...n.user,role:e.target.value}})),children:[(0,i.jsx)(E.Z,{value:"admin",children:"Admin"}),(0,i.jsx)(E.Z,{value:"user",children:"User"}),(0,i.jsx)(E.Z,{value:"viewer",children:"Viewer"})]})]}),(0,i.jsxs)(C.Z,{fullWidth:!0,children:[(0,i.jsx)(b.Z,{children:"Status"}),(0,i.jsxs)(S.Z,{value:(null===(U=ea.user)||void 0===U?void 0:U.status)||"",onChange:e=>ei(n=>({...n,user:{...n.user,status:e.target.value}})),children:[(0,i.jsx)(E.Z,{value:"active",children:"Active"}),(0,i.jsx)(E.Z,{value:"suspended",children:"Suspended"})]})]})]})}),(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(h.Z,{onClick:()=>ei({open:!1,user:null}),children:"Cancel"}),(0,i.jsx)(h.Z,{variant:"contained",onClick:()=>el(ea.user),children:"Save"})]})]}),(0,i.jsxs)(Z.Z,{open:et.open,onClose:()=>er({open:!1,camera:null}),children:[(0,i.jsx)(v.Z,{children:(null===(D=et.camera)||void 0===D?void 0:D.id)?"Edit Camera":"Add Camera"}),(0,i.jsx)(y.Z,{children:(0,i.jsxs)(r.Z,{sx:{pt:2},children:[(0,i.jsx)(w.Z,{fullWidth:!0,label:"Name",value:(null===(I=et.camera)||void 0===I?void 0:I.name)||"",onChange:e=>er(n=>({...n,camera:{...n.camera,name:e.target.value}})),sx:{mb:2}}),(0,i.jsx)(w.Z,{fullWidth:!0,label:"Location",value:(null===(_=et.camera)||void 0===_?void 0:_.location)||"",onChange:e=>er(n=>({...n,camera:{...n.camera,location:e.target.value}})),sx:{mb:2}}),(0,i.jsxs)(C.Z,{fullWidth:!0,sx:{mb:2},children:[(0,i.jsx)(b.Z,{children:"Type"}),(0,i.jsxs)(S.Z,{value:(null===(J=et.camera)||void 0===J?void 0:J.type)||"",onChange:e=>er(n=>({...n,camera:{...n.camera,type:e.target.value}})),children:[(0,i.jsx)(E.Z,{value:"facial",children:"Facial Recognition"}),(0,i.jsx)(E.Z,{value:"security",children:"Security"})]})]}),(0,i.jsx)(A.Z,{control:(0,i.jsx)(k.Z,{checked:(null===(V=et.camera)||void 0===V?void 0:V.enabled)||!1,onChange:e=>er(n=>({...n,camera:{...n.camera,enabled:e.target.checked}}))}),label:"Enabled"})]})}),(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(h.Z,{onClick:()=>er({open:!1,camera:null}),children:"Cancel"}),(0,i.jsx)(h.Z,{variant:"contained",onClick:()=>eo(et.camera),children:"Save"})]})]})]})})}var U=a(47907);function D(){let{user:e,isLoading:n}=(0,T.aC)(),a=(0,U.useRouter)();return((0,t.useEffect)(()=>{n||e&&"admin"===e.role||a.push("/unauthorized")},[e,n,a]),n||!e)?(0,i.jsx)(r.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,i.jsx)(s.Z,{})}):(0,i.jsx)(W,{})}},25166:function(e,n,a){"use strict";a.d(n,{l:function(){return o}});var i=a(3827),t=a(4598),r=a(10470),s=a(29835),l=a(54272);function o(e){let{children:n,title:a}=e;return(0,i.jsx)(t.Z,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,i.jsxs)(r.Z,{sx:{p:4},children:[(0,i.jsx)(s.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:a}),(0,i.jsx)(l.Z,{sx:{mt:3},children:n})]})})}},2888:function(e,n,a){"use strict";a.d(n,{aC:function(){return r}});var i=a(64090),t=a(84586);function r(){let e=(0,i.useContext)(t.V);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}a(47907)},84586:function(e,n,a){"use strict";a.d(n,{H:function(){return l},V:function(){return s}});var i=a(3827),t=a(64090),r=a(47907);let s=(0,t.createContext)(null);function l(e){let{children:n}=e,a=(0,r.useRouter)(),[l,o]=(0,t.useState)({user:null,isAuthenticated:!1,isLoading:!0,error:null}),d=e=>{o(n=>({...n,error:e}))},c=async e=>{try{d(null),o(e=>({...e,isLoading:!0})),o(n=>({...n,user:e,isAuthenticated:!0,isLoading:!1})),a.push("/dashboard")}catch(e){throw o(n=>({...n,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},u=async e=>{try{var n;d(null),o(e=>({...e,isLoading:!0}));let i=await fetch("/api/auth/login/face",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({faceData:e})});if(!i.ok)throw Error("Face recognition login failed");let t=await i.json();if(!t.success||!(null===(n=t.data)||void 0===n?void 0:n.user))throw Error(t.error||"Face recognition login failed");o(e=>({...e,user:t.data.user,isAuthenticated:!0,isLoading:!1})),a.push("/dashboard")}catch(e){throw o(n=>({...n,isLoading:!1,error:e instanceof Error?e.message:"Face recognition login failed"})),e}},h=async e=>{try{var n;d(null),o(e=>({...e,isLoading:!0}));let i=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!i.ok)throw Error("Registration failed");let t=await i.json();if(!t.success||!(null===(n=t.data)||void 0===n?void 0:n.user))throw Error(t.error||"Registration failed");o(e=>({...e,user:t.data.user,isAuthenticated:!0,isLoading:!1})),a.push("/dashboard")}catch(e){throw o(n=>({...n,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"})),e}},x=async()=>{try{d(null),o(e=>({...e,isLoading:!0})),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),o({user:null,isAuthenticated:!1,isLoading:!1,error:null}),a.push("/login")}catch(e){o(n=>({...n,isLoading:!1,error:e instanceof Error?e.message:"Logout failed"}))}},m=async e=>{try{d(null),o(e=>({...e,isLoading:!0}));let n=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});if(!n.ok)throw Error("Password reset failed");let a=await n.json();if(!a.success)throw Error(a.error||"Password reset failed");o(e=>({...e,isLoading:!1}))}catch(e){throw o(n=>({...n,isLoading:!1,error:e instanceof Error?e.message:"Password reset failed"})),e}},j=async(e,n,i)=>{try{d(null),o(e=>({...e,isLoading:!0}));let t=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:n,confirmPassword:i})});if(!t.ok)throw Error("Password update failed");let r=await t.json();if(!r.success)throw Error(r.error||"Password update failed");o(e=>({...e,isLoading:!1})),a.push("/login")}catch(e){throw o(n=>({...n,isLoading:!1,error:e instanceof Error?e.message:"Password update failed"})),e}};(0,t.useEffect)(()=>{!async function(){try{var e;let n=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(!n.ok)throw Error("Authentication check failed");let a=await n.json();a.success&&(null===(e=a.data)||void 0===e?void 0:e.user)?o({user:a.data.user,isAuthenticated:!0,isLoading:!1,error:null}):o({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(e){o({user:null,isAuthenticated:!1,isLoading:!1,error:e instanceof Error?e.message:"Authentication check failed"})}}()},[]);let f={...l,login:c,loginWithFace:u,register:h,logout:x,resetPassword:m,updatePassword:j};return(0,i.jsx)(s.Provider,{value:f,children:n})}}},function(e){e.O(0,[463,26,756,355,585,258,206,894,818,859,466,423,889,971,69,744],function(){return e(e.s=20309)}),_N_E=e.O()}]);