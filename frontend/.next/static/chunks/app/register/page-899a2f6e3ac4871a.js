(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{60814:function(e,r,t){Promise.resolve().then(t.bind(t,18929))},18929:function(e,r,t){"use strict";t.r(r),t.d(r,{Register:function(){return g}});var i=t(3827),a=t(64090),n=t(2888),s=t(47907),o=t(4598),l=t(54272),d=t(10470),u=t(29835),c=t(72921),h=t(6285),f=t(66910);let g=()=>{let{register:e}=(0,n.aC)(),[r,t]=(0,a.useState)(!1),[g,p]=(0,a.useState)(null),w=(0,s.useRouter)(),[m,y]=(0,a.useState)({email:"",password:""}),L=e=>{let{name:r,value:t}=e.target;y(e=>({...e,[r]:t}))},E=async r=>{r.preventDefault(),p(null),t(!0);try{await e(m),w.push("/dashboard")}catch(e){p("Registration failed. Please try again.")}finally{t(!1)}};return(0,i.jsx)(o.Z,{maxWidth:"sm",children:(0,i.jsx)(l.Z,{sx:{mt:8},children:(0,i.jsxs)(d.Z,{sx:{p:4},children:[(0,i.jsx)(u.Z,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Register"}),g&&(0,i.jsx)(u.Z,{color:"error",align:"center",gutterBottom:!0,children:g}),(0,i.jsxs)("form",{onSubmit:E,children:[(0,i.jsx)(c.Z,{fullWidth:!0,margin:"normal",label:"Email",name:"email",type:"email",value:m.email,onChange:L,disabled:r,required:!0}),(0,i.jsx)(c.Z,{fullWidth:!0,margin:"normal",label:"Password",name:"password",type:"password",value:m.password,onChange:L,disabled:r,required:!0}),(0,i.jsx)(l.Z,{sx:{mt:3},children:(0,i.jsx)(h.Z,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:r,children:r?(0,i.jsx)(f.Z,{size:24}):"Register"})})]})]})})})}},2888:function(e,r,t){"use strict";t.d(r,{aC:function(){return n}});var i=t(64090),a=t(84586);function n(){let e=(0,i.useContext)(a.V);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}t(47907)},84586:function(e,r,t){"use strict";t.d(r,{H:function(){return o},V:function(){return s}});var i=t(3827),a=t(64090),n=t(47907);let s=(0,a.createContext)(null);function o(e){let{children:r}=e,t=(0,n.useRouter)(),[o,l]=(0,a.useState)({user:null,isAuthenticated:!1,isLoading:!0,error:null}),d=e=>{l(r=>({...r,error:e}))},u=async e=>{try{d(null),l(e=>({...e,isLoading:!0})),l(r=>({...r,user:e,isAuthenticated:!0,isLoading:!1})),t.push("/dashboard")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},c=async e=>{try{var r;d(null),l(e=>({...e,isLoading:!0}));let i=await fetch("/api/auth/login/face",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({faceData:e})});if(!i.ok)throw Error("Face recognition login failed");let a=await i.json();if(!a.success||!(null===(r=a.data)||void 0===r?void 0:r.user))throw Error(a.error||"Face recognition login failed");l(e=>({...e,user:a.data.user,isAuthenticated:!0,isLoading:!1})),t.push("/dashboard")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Face recognition login failed"})),e}},h=async e=>{try{var r;d(null),l(e=>({...e,isLoading:!0}));let i=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!i.ok)throw Error("Registration failed");let a=await i.json();if(!a.success||!(null===(r=a.data)||void 0===r?void 0:r.user))throw Error(a.error||"Registration failed");l(e=>({...e,user:a.data.user,isAuthenticated:!0,isLoading:!1})),t.push("/dashboard")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"})),e}},f=async()=>{try{d(null),l(e=>({...e,isLoading:!0})),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),l({user:null,isAuthenticated:!1,isLoading:!1,error:null}),t.push("/login")}catch(e){l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Logout failed"}))}},g=async e=>{try{d(null),l(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});if(!r.ok)throw Error("Password reset failed");let t=await r.json();if(!t.success)throw Error(t.error||"Password reset failed");l(e=>({...e,isLoading:!1}))}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Password reset failed"})),e}},p=async(e,r,i)=>{try{d(null),l(e=>({...e,isLoading:!0}));let a=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:r,confirmPassword:i})});if(!a.ok)throw Error("Password update failed");let n=await a.json();if(!n.success)throw Error(n.error||"Password update failed");l(e=>({...e,isLoading:!1})),t.push("/login")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Password update failed"})),e}};(0,a.useEffect)(()=>{!async function(){try{var e;let r=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(!r.ok)throw Error("Authentication check failed");let t=await r.json();t.success&&(null===(e=t.data)||void 0===e?void 0:e.user)?l({user:t.data.user,isAuthenticated:!0,isLoading:!1,error:null}):l({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(e){l({user:null,isAuthenticated:!1,isLoading:!1,error:e instanceof Error?e.message:"Authentication check failed"})}}()},[]);let w={...o,login:u,loginWithFace:c,register:h,logout:f,resetPassword:g,updatePassword:p};return(0,i.jsx)(s.Provider,{value:w,children:r})}}},function(e){e.O(0,[463,26,756,355,585,258,206,971,69,744],function(){return e(e.s=60814)}),_N_E=e.O()}]);