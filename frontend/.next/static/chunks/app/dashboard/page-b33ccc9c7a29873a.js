(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{40841:function(e,t,i){Promise.resolve().then(i.bind(i,4461))},4461:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return g}});var r=i(3827),n=i(64090),s=i(54272),a=i(66910),o=i(4598),d=i(29835),u=i(82508),l=i(10470),c=i(2888);let h=()=>{let{user:e}=(0,c.aC)();return e?(0,r.jsx)(o.Z,{maxWidth:"lg",children:(0,r.jsxs)(s.Z,{sx:{mt:4},children:[(0,r.jsxs)(d.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:["Welcome, ",e.email.split("@")[0],"!"]}),(0,r.jsxs)(u.ZP,{container:!0,spacing:3,children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,r.jsxs)(l.Z,{sx:{p:3},children:[(0,r.jsx)(d.Z,{variant:"h6",gutterBottom:!0,children:"User Information"}),(0,r.jsxs)(d.Z,{children:["Email: ",e.email]}),(0,r.jsxs)(d.Z,{children:["Role: ",e.role]}),(0,r.jsxs)(d.Z,{children:["Permissions: ",e.permissions.join(", ")||"None"]})]})}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,r.jsxs)(l.Z,{sx:{p:3},children:[(0,r.jsx)(d.Z,{variant:"h6",gutterBottom:!0,children:"Security Zones"}),e.zones.length>0?(0,r.jsx)("ul",{children:e.zones.map((e,t)=>(0,r.jsx)("li",{children:e},t))}):(0,r.jsx)(d.Z,{children:"No zones assigned"})]})})]})]})}):null};var f=i(47907);function g(){let{user:e,isLoading:t}=(0,c.aC)(),i=(0,f.useRouter)();return((0,n.useEffect)(()=>{t||e||i.push("/login")},[e,t,i]),t||!e)?(0,r.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,r.jsx)(a.Z,{})}):(0,r.jsx)(h,{})}},2888:function(e,t,i){"use strict";i.d(t,{aC:function(){return s}});var r=i(64090),n=i(84586);function s(){let e=(0,r.useContext)(n.V);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}i(47907)},84586:function(e,t,i){"use strict";i.d(t,{H:function(){return o},V:function(){return a}});var r=i(3827),n=i(64090),s=i(47907);let a=(0,n.createContext)(null);function o(e){let{children:t}=e,i=(0,s.useRouter)(),[o,d]=(0,n.useState)({user:null,isAuthenticated:!1,isLoading:!0,error:null}),u=e=>{d(t=>({...t,error:e}))},l=async e=>{try{u(null),d(e=>({...e,isLoading:!0})),d(t=>({...t,user:e,isAuthenticated:!0,isLoading:!1})),i.push("/dashboard")}catch(e){throw d(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},c=async e=>{try{var t;u(null),d(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/login/face",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({faceData:e})});if(!r.ok)throw Error("Face recognition login failed");let n=await r.json();if(!n.success||!(null===(t=n.data)||void 0===t?void 0:t.user))throw Error(n.error||"Face recognition login failed");d(e=>({...e,user:n.data.user,isAuthenticated:!0,isLoading:!1})),i.push("/dashboard")}catch(e){throw d(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Face recognition login failed"})),e}},h=async e=>{try{var t;u(null),d(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!r.ok)throw Error("Registration failed");let n=await r.json();if(!n.success||!(null===(t=n.data)||void 0===t?void 0:t.user))throw Error(n.error||"Registration failed");d(e=>({...e,user:n.data.user,isAuthenticated:!0,isLoading:!1})),i.push("/dashboard")}catch(e){throw d(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"})),e}},f=async()=>{try{u(null),d(e=>({...e,isLoading:!0})),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),d({user:null,isAuthenticated:!1,isLoading:!1,error:null}),i.push("/login")}catch(e){d(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Logout failed"}))}},g=async e=>{try{u(null),d(e=>({...e,isLoading:!0}));let t=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});if(!t.ok)throw Error("Password reset failed");let i=await t.json();if(!i.success)throw Error(i.error||"Password reset failed");d(e=>({...e,isLoading:!1}))}catch(e){throw d(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password reset failed"})),e}},p=async(e,t,r)=>{try{u(null),d(e=>({...e,isLoading:!0}));let n=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:t,confirmPassword:r})});if(!n.ok)throw Error("Password update failed");let s=await n.json();if(!s.success)throw Error(s.error||"Password update failed");d(e=>({...e,isLoading:!1})),i.push("/login")}catch(e){throw d(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password update failed"})),e}};(0,n.useEffect)(()=>{!async function(){try{var e;let t=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(!t.ok)throw Error("Authentication check failed");let i=await t.json();i.success&&(null===(e=i.data)||void 0===e?void 0:e.user)?d({user:i.data.user,isAuthenticated:!0,isLoading:!1,error:null}):d({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(e){d({user:null,isAuthenticated:!1,isLoading:!1,error:e instanceof Error?e.message:"Authentication check failed"})}}()},[]);let m={...o,login:l,loginWithFace:c,register:h,logout:f,resetPassword:g,updatePassword:p};return(0,r.jsx)(a.Provider,{value:m,children:t})}},4598:function(e,t,i){"use strict";i.d(t,{Z:function(){return Z}});var r=i(70444),n=i(14749),s=i(64090),a=i(75504),o=i(70533),d=i(44174),u=i(65613),l=i(15516),c=i(57719),h=i(21989),f=i(3827);let g=["className","component","disableGutters","fixed","maxWidth","classes"],p=(0,h.Z)(),m=(0,c.Z)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.root,t["maxWidth".concat((0,u.Z)(String(i.maxWidth)))],i.fixed&&t.fixed,i.disableGutters&&t.disableGutters]}}),x=e=>(0,l.Z)({props:e,name:"MuiContainer",defaultTheme:p}),w=(e,t)=>{let{classes:i,fixed:r,disableGutters:n,maxWidth:s}=e,a={root:["root",s&&"maxWidth".concat((0,u.Z)(String(s))),r&&"fixed",n&&"disableGutters"]};return(0,d.Z)(a,e=>(0,o.ZP)(t,e),i)};var v=i(95135),b=i(58836),j=i(19048),Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{createStyledComponent:t=m,useThemeProps:i=x,componentName:o="MuiContainer"}=e,d=t(e=>{let{theme:t,ownerState:i}=e;return(0,n.Z)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!i.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}})},e=>{let{theme:t,ownerState:i}=e;return i.fixed&&Object.keys(t.breakpoints.values).reduce((e,i)=>{let r=t.breakpoints.values[i];return 0!==r&&(e[t.breakpoints.up(i)]={maxWidth:"".concat(r).concat(t.breakpoints.unit)}),e},{})},e=>{let{theme:t,ownerState:i}=e;return(0,n.Z)({},"xs"===i.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},i.maxWidth&&"xs"!==i.maxWidth&&{[t.breakpoints.up(i.maxWidth)]:{maxWidth:"".concat(t.breakpoints.values[i.maxWidth]).concat(t.breakpoints.unit)}})});return s.forwardRef(function(e,t){let s=i(e),{className:u,component:l="div",disableGutters:c=!1,fixed:h=!1,maxWidth:p="lg"}=s,m=(0,r.Z)(s,g),x=(0,n.Z)({},s,{component:l,disableGutters:c,fixed:h,maxWidth:p}),v=w(x,o);return(0,f.jsx)(d,(0,n.Z)({as:l,ownerState:x,className:(0,a.Z)(v.root,u),ref:t},m))})}({createStyledComponent:(0,b.ZP)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.root,t["maxWidth".concat((0,v.Z)(String(i.maxWidth)))],i.fixed&&t.fixed,i.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,j.i)({props:e,name:"MuiContainer"})})},47907:function(e,t,i){"use strict";var r=i(15313);i.o(r,"useRouter")&&i.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[463,26,756,585,508,971,69,744],function(){return e(e.s=40841)}),_N_E=e.O()}]);