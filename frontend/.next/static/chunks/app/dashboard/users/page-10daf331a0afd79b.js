(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{63620:function(e,r,t){Promise.resolve().then(t.bind(t,1972))},1972:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return R}});var a=t(3827),s=t(4598),n=t(64090),i=t(54272),o=t(66910),l=t(83894),c=t(29835),d=t(6285),u=t(64845),h=t(10470),f=t(86520),g=t(30412),w=t(98430),p=t(4558),j=t(20360),m=t(54784),y=t(43206),x=t(73957),Z=t(60036),E=t(40512),v=t(67147),C=t(72921),L=t(41848),P=t(9186),k=t(12148),A=t(24293),S=t(89969),b=t(57674),T=t(26009),O=t(43260);let N=()=>{let[e,r]=(0,n.useState)([]),[t,a]=(0,n.useState)(!0),[s,i]=(0,n.useState)(null),o=async()=>{try{a(!0);let e=await fetch("/api/users");if(!e.ok)throw Error("Failed to fetch users");let t=await e.json();r(t)}catch(e){i(e instanceof Error?e.message:"An error occurred")}finally{a(!1)}},l=async e=>{try{a(!0);let t=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to create user");let s=await t.json();r(e=>[...e,s])}catch(e){throw i(e instanceof Error?e.message:"An error occurred"),e}finally{a(!1)}},c=async(e,t)=>{try{a(!0);let s=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error("Failed to update user");let n=await s.json();r(r=>r.map(r=>r.id===e?n:r))}catch(e){throw i(e instanceof Error?e.message:"An error occurred"),e}finally{a(!1)}},d=async e=>{try{if(a(!0),!(await fetch("/api/users/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete user");r(r=>r.filter(r=>r.id!==e))}catch(e){throw i(e instanceof Error?e.message:"An error occurred"),e}finally{a(!1)}},u=async e=>{try{a(!0);let r=await fetch("/api/users/".concat(e));if(!r.ok)throw Error("Failed to fetch user");return await r.json()}catch(e){throw i(e instanceof Error?e.message:"An error occurred"),e}finally{a(!1)}};return(0,n.useEffect)(()=>{o()},[]),{users:e,loading:t,error:s,createUser:l,updateUser:c,deleteUser:d,getUser:u}},U=()=>{let[e,r]=(0,n.useState)(0),[t,s]=(0,n.useState)(10),[U,F]=(0,n.useState)(!1),[R,J]=(0,n.useState)(null),[_,W]=(0,n.useState)({username:"",email:"",role:"user",password:""}),{users:I,loading:V,error:D,createUser:G,updateUser:H,deleteUser:M}=N(),q=async()=>{try{await G(_),F(!1),K()}catch(e){}},z=async()=>{if(R)try{let e={..._};e.password||delete e.password,await H(R.id,e),F(!1),J(null),K()}catch(e){}},B=async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{await M(e)}catch(e){}},K=()=>{W({username:"",email:"",role:"user",password:""})},Q=e=>{J(e),W({username:e.username,email:e.email,role:e.role,password:""}),F(!0)};return V?(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,a.jsx)(o.Z,{})}):D?(0,a.jsx)(i.Z,{sx:{p:3},children:(0,a.jsx)(l.Z,{severity:"error",children:D})}):(0,a.jsxs)(i.Z,{sx:{p:3},children:[(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,a.jsx)(c.Z,{variant:"h5",children:"User Management"}),(0,a.jsx)(d.Z,{variant:"contained",startIcon:(0,a.jsx)(b.Z,{}),onClick:()=>{J(null),K(),F(!0)},children:"Add User"})]}),(0,a.jsxs)(u.Z,{component:h.Z,children:[(0,a.jsxs)(f.Z,{children:[(0,a.jsx)(g.Z,{children:(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(p.Z,{children:"Username"}),(0,a.jsx)(p.Z,{children:"Email"}),(0,a.jsx)(p.Z,{children:"Role"}),(0,a.jsx)(p.Z,{children:"Status"}),(0,a.jsx)(p.Z,{children:"Actions"})]})}),(0,a.jsx)(j.Z,{children:I.slice(e*t,e*t+t).map(e=>(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(p.Z,{children:e.username}),(0,a.jsx)(p.Z,{children:e.email}),(0,a.jsx)(p.Z,{children:e.role}),(0,a.jsx)(p.Z,{children:(0,a.jsx)(m.Z,{label:e.status,color:"active"===e.status?"success":"suspended"===e.status?"error":"default"})}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(y.Z,{onClick:()=>Q(e),color:"primary",children:(0,a.jsx)(T.Z,{})}),(0,a.jsx)(y.Z,{onClick:()=>B(e.id),color:"error",children:(0,a.jsx)(O.Z,{})})]})]},e.id))})]}),(0,a.jsx)(x.Z,{rowsPerPageOptions:[5,10,25],component:"div",count:I.length,rowsPerPage:t,page:e,onPageChange:(e,t)=>{r(t)},onRowsPerPageChange:e=>{s(parseInt(e.target.value,10)),r(0)}})]}),(0,a.jsxs)(Z.Z,{open:U,onClose:()=>F(!1),children:[(0,a.jsx)(E.Z,{children:R?"Edit User":"Add New User"}),(0,a.jsx)(v.Z,{children:(0,a.jsxs)(i.Z,{sx:{pt:2},children:[(0,a.jsx)(C.Z,{fullWidth:!0,label:"Username",value:_.username,onChange:e=>W({..._,username:e.target.value}),margin:"normal"}),(0,a.jsx)(C.Z,{fullWidth:!0,label:"Email",type:"email",value:_.email,onChange:e=>W({..._,email:e.target.value}),margin:"normal"}),(0,a.jsxs)(L.Z,{fullWidth:!0,margin:"normal",children:[(0,a.jsx)(P.Z,{children:"Role"}),(0,a.jsxs)(k.Z,{value:_.role,onChange:e=>W({..._,role:e.target.value}),label:"Role",children:[(0,a.jsx)(A.Z,{value:"admin",children:"Admin"}),(0,a.jsx)(A.Z,{value:"user",children:"User"}),(0,a.jsx)(A.Z,{value:"viewer",children:"Viewer"})]})]}),(0,a.jsx)(C.Z,{fullWidth:!0,label:"Password",type:"password",value:_.password,onChange:e=>W({..._,password:e.target.value}),margin:"normal",helperText:R?"Leave blank to keep current password":""})]})}),(0,a.jsxs)(S.Z,{children:[(0,a.jsx)(d.Z,{onClick:()=>F(!1),children:"Cancel"}),(0,a.jsx)(d.Z,{onClick:R?z:q,variant:"contained",children:R?"Update":"Create"})]})]})]})};var F=t(2888);function R(){let{user:e}=(0,F.aC)();return e?(0,a.jsx)(s.Z,{maxWidth:"lg",children:(0,a.jsx)(U,{})}):null}},2888:function(e,r,t){"use strict";t.d(r,{aC:function(){return n}});var a=t(64090),s=t(84586);function n(){let e=(0,a.useContext)(s.V);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}t(47907)},84586:function(e,r,t){"use strict";t.d(r,{H:function(){return o},V:function(){return i}});var a=t(3827),s=t(64090),n=t(47907);let i=(0,s.createContext)(null);function o(e){let{children:r}=e,t=(0,n.useRouter)(),[o,l]=(0,s.useState)({user:null,isAuthenticated:!1,isLoading:!0,error:null}),c=e=>{l(r=>({...r,error:e}))},d=async e=>{try{c(null),l(e=>({...e,isLoading:!0})),l(r=>({...r,user:e,isAuthenticated:!0,isLoading:!1})),t.push("/dashboard")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},u=async e=>{try{var r;c(null),l(e=>({...e,isLoading:!0}));let a=await fetch("/api/auth/login/face",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({faceData:e})});if(!a.ok)throw Error("Face recognition login failed");let s=await a.json();if(!s.success||!(null===(r=s.data)||void 0===r?void 0:r.user))throw Error(s.error||"Face recognition login failed");l(e=>({...e,user:s.data.user,isAuthenticated:!0,isLoading:!1})),t.push("/dashboard")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Face recognition login failed"})),e}},h=async e=>{try{var r;c(null),l(e=>({...e,isLoading:!0}));let a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!a.ok)throw Error("Registration failed");let s=await a.json();if(!s.success||!(null===(r=s.data)||void 0===r?void 0:r.user))throw Error(s.error||"Registration failed");l(e=>({...e,user:s.data.user,isAuthenticated:!0,isLoading:!1})),t.push("/dashboard")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"})),e}},f=async()=>{try{c(null),l(e=>({...e,isLoading:!0})),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),l({user:null,isAuthenticated:!1,isLoading:!1,error:null}),t.push("/login")}catch(e){l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Logout failed"}))}},g=async e=>{try{c(null),l(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});if(!r.ok)throw Error("Password reset failed");let t=await r.json();if(!t.success)throw Error(t.error||"Password reset failed");l(e=>({...e,isLoading:!1}))}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Password reset failed"})),e}},w=async(e,r,a)=>{try{c(null),l(e=>({...e,isLoading:!0}));let s=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:r,confirmPassword:a})});if(!s.ok)throw Error("Password update failed");let n=await s.json();if(!n.success)throw Error(n.error||"Password update failed");l(e=>({...e,isLoading:!1})),t.push("/login")}catch(e){throw l(r=>({...r,isLoading:!1,error:e instanceof Error?e.message:"Password update failed"})),e}};(0,s.useEffect)(()=>{!async function(){try{var e;let r=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(!r.ok)throw Error("Authentication check failed");let t=await r.json();t.success&&(null===(e=t.data)||void 0===e?void 0:e.user)?l({user:t.data.user,isAuthenticated:!0,isLoading:!1,error:null}):l({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(e){l({user:null,isAuthenticated:!1,isLoading:!1,error:e instanceof Error?e.message:"Authentication check failed"})}}()},[]);let p={...o,login:d,loginWithFace:u,register:h,logout:f,resetPassword:g,updatePassword:w};return(0,a.jsx)(i.Provider,{value:p,children:r})}}},function(e){e.O(0,[463,26,756,355,585,258,206,894,859,85,971,69,744],function(){return e(e.s=63620)}),_N_E=e.O()}]);