(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{11181:function(e,t,s){Promise.resolve().then(s.bind(s,83102))},25166:function(e,t,s){"use strict";s.d(t,{l:function(){return c}});var a=s(3827),r=s(4598),i=s(10470),n=s(29835),o=s(54272);function c(e){let{children:t,title:s}=e;return(0,a.jsx)(r.Z,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,a.jsxs)(i.Z,{sx:{p:4},children:[(0,a.jsx)(n.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:s}),(0,a.jsx)(o.Z,{sx:{mt:3},children:t})]})})}},2888:function(e,t,s){"use strict";s.d(t,{aC:function(){return i}});var a=s(64090),r=s(84586);function i(){let e=(0,a.useContext)(r.V);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}s(47907)},84586:function(e,t,s){"use strict";s.d(t,{H:function(){return o},V:function(){return n}});var a=s(3827),r=s(64090),i=s(47907);let n=(0,r.createContext)(null);function o(e){let{children:t}=e,s=(0,i.useRouter)(),[o,c]=(0,r.useState)({user:null,isAuthenticated:!1,isLoading:!0,error:null}),l=e=>{c(t=>({...t,error:e}))},d=async e=>{try{l(null),c(e=>({...e,isLoading:!0})),c(t=>({...t,user:e,isAuthenticated:!0,isLoading:!1})),s.push("/dashboard")}catch(e){throw c(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},u=async e=>{try{var t;l(null),c(e=>({...e,isLoading:!0}));let a=await fetch("/api/auth/login/face",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({faceData:e})});if(!a.ok)throw Error("Face recognition login failed");let r=await a.json();if(!r.success||!(null===(t=r.data)||void 0===t?void 0:t.user))throw Error(r.error||"Face recognition login failed");c(e=>({...e,user:r.data.user,isAuthenticated:!0,isLoading:!1})),s.push("/dashboard")}catch(e){throw c(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Face recognition login failed"})),e}},h=async e=>{try{var t;l(null),c(e=>({...e,isLoading:!0}));let a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!a.ok)throw Error("Registration failed");let r=await a.json();if(!r.success||!(null===(t=r.data)||void 0===t?void 0:t.user))throw Error(r.error||"Registration failed");c(e=>({...e,user:r.data.user,isAuthenticated:!0,isLoading:!1})),s.push("/dashboard")}catch(e){throw c(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"})),e}},x=async()=>{try{l(null),c(e=>({...e,isLoading:!0})),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),c({user:null,isAuthenticated:!1,isLoading:!1,error:null}),s.push("/login")}catch(e){c(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Logout failed"}))}},m=async e=>{try{l(null),c(e=>({...e,isLoading:!0}));let t=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});if(!t.ok)throw Error("Password reset failed");let s=await t.json();if(!s.success)throw Error(s.error||"Password reset failed");c(e=>({...e,isLoading:!1}))}catch(e){throw c(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password reset failed"})),e}},g=async(e,t,a)=>{try{l(null),c(e=>({...e,isLoading:!0}));let r=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:t,confirmPassword:a})});if(!r.ok)throw Error("Password update failed");let i=await r.json();if(!i.success)throw Error(i.error||"Password update failed");c(e=>({...e,isLoading:!1})),s.push("/login")}catch(e){throw c(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password update failed"})),e}};(0,r.useEffect)(()=>{!async function(){try{var e;let t=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(!t.ok)throw Error("Authentication check failed");let s=await t.json();s.success&&(null===(e=s.data)||void 0===e?void 0:e.user)?c({user:s.data.user,isAuthenticated:!0,isLoading:!1,error:null}):c({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(e){c({user:null,isAuthenticated:!1,isLoading:!1,error:e instanceof Error?e.message:"Authentication check failed"})}}()},[]);let j={...o,login:d,loginWithFace:u,register:h,logout:x,resetPassword:m,updatePassword:g};return(0,a.jsx)(n.Provider,{value:j,children:t})}},83102:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return U}});var a=s(3827),r=s(64090),i=s(54272),n=s(66910),o=s(4598),c=s(83894),l=s(29835),d=s(6285),u=s(82508),h=s(10470),x=s(85195),m=s(47002),g=s(95996),j=s(94589),p=s(90144),f=s(21551),Z=s(88433),y=s(93070),v=s(44466),w=s(72921),S=s(60036),b=s(40512),k=s(67147),P=s(89969),C=s(66265),E=s(84727),L=s(43789),B=s(48698),A=s(2888),O=s(25166);function T(){var e;let{user:t}=(0,A.aC)(),[s,T]=(0,r.useState)(!0),[R,U]=(0,r.useState)(null),[F,M]=(0,r.useState)({cpu:{usage:0,temperature:0},memory:{total:0,used:0,free:0},storage:{total:0,used:0,free:0,recordings:0,logs:0,backups:0,lastBackup:new Date().toISOString()},uptime:0,lastUpdate:new Date().toISOString()}),[N,I]=(0,r.useState)([]),[_,D]=(0,r.useState)({schedule:"0 0 * * *",retention:7,location:"/backups"}),[W,z]=(0,r.useState)(!1),[J,G]=(0,r.useState)(0),[K,V]=(0,r.useState)(!0),[H,q]=(0,r.useState)("30"),[Q,X]=(0,r.useState)(!1);(0,r.useEffect)(()=>{Y(),$(),ee();let e=setInterval(Y,5e3);return()=>clearInterval(e)},[]);let Y=async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/v1/system/metrics"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch system metrics");let t=await e.json(),s=await fetch("".concat("http://localhost:8000","/api/v1/system/storage"),{credentials:"include"});if(!s.ok)throw Error("Failed to fetch storage metrics");let a=await s.json();M({cpu:{usage:t.cpu,temperature:65},memory:{total:t.memory.total,used:t.memory.used,free:t.memory.free},storage:{total:a.total,used:a.used,free:a.available,recordings:a.recordingsSize,logs:a.logsSize,backups:a.backupSize,lastBackup:a.lastBackup},uptime:t.uptime,lastUpdate:t.lastUpdate}),T(!1)}catch(e){U(e instanceof Error?e.message:"Failed to fetch system status"),T(!1)}},$=async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/v1/system/logs"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch maintenance logs");let t=await e.json();I(t)}catch(e){}},ee=async()=>{try{let e=await fetch("".concat("http://localhost:8000","/api/v1/system/backup-config"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch backup config");let t=await e.json();D(t)}catch(e){}},et=async()=>{try{if(G(0),!(await fetch("".concat("http://localhost:8000","/api/v1/system/backup"),{method:"POST",credentials:"include"})).ok)throw Error("Backup failed");for(let e=0;e<=100;e+=10)await new Promise(e=>setTimeout(e,500)),G(e);z(!1),await Y(),await $()}catch(e){U(e instanceof Error?e.message:"Backup failed")}},es=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat((e/Math.pow(1024,t)).toFixed(2)," ").concat(["B","KB","MB","GB","TB"][t])};return R?(0,a.jsx)(O.l,{title:"System Settings",children:(0,a.jsx)(o.Z,{children:(0,a.jsx)(c.Z,{severity:"error",sx:{mt:4},children:R})})}):(0,a.jsx)(O.l,{title:"System Settings",children:(0,a.jsxs)(o.Z,{maxWidth:"xl",children:[(0,a.jsxs)(i.Z,{sx:{mt:4},children:[(0,a.jsxs)(i.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(l.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"System Settings"}),(0,a.jsx)(d.Z,{variant:"contained",color:"primary",startIcon:(0,a.jsx)(C.Z,{}),onClick:()=>z(!0),children:"Create Backup"})]}),s?(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,a.jsx)(n.Z,{})}):(0,a.jsxs)(u.ZP,{container:!0,spacing:3,children:[(0,a.jsx)(u.ZP,{item:!0,xs:12,md:8,children:(0,a.jsxs)(h.Z,{sx:{p:3},children:[(0,a.jsx)(l.Z,{variant:"h6",gutterBottom:!0,children:"System Status"}),(0,a.jsxs)(u.ZP,{container:!0,spacing:3,children:[(0,a.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(m.Z,{avatar:(0,a.jsx)(E.Z,{}),title:"CPU Usage",subheader:"".concat(F.cpu.usage,"% | ").concat(F.cpu.temperature,"\xb0C")}),(0,a.jsx)(g.Z,{children:(0,a.jsx)(j.Z,{variant:"determinate",value:F.cpu.usage,sx:{height:10,borderRadius:5}})})]})}),(0,a.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(m.Z,{avatar:(0,a.jsx)(L.Z,{}),title:"Memory",subheader:"".concat(es(F.memory.used)," / ").concat(es(F.memory.total))}),(0,a.jsx)(g.Z,{children:(0,a.jsx)(j.Z,{variant:"determinate",value:F.memory.used/F.memory.total*100,sx:{height:10,borderRadius:5}})})]})}),(0,a.jsx)(u.ZP,{item:!0,xs:12,children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(m.Z,{avatar:(0,a.jsx)(L.Z,{}),title:"Storage",subheader:"".concat(es(F.storage.used)," / ").concat(es(F.storage.total))}),(0,a.jsxs)(g.Z,{children:[(0,a.jsx)(j.Z,{variant:"determinate",value:F.storage.used/F.storage.total*100,sx:{height:10,borderRadius:5}}),(0,a.jsxs)(u.ZP,{container:!0,spacing:2,sx:{mt:2},children:[(0,a.jsxs)(u.ZP,{item:!0,xs:4,children:[(0,a.jsx)(l.Z,{variant:"subtitle2",color:"textSecondary",children:"Recordings"}),(0,a.jsx)(l.Z,{variant:"body1",children:es(F.storage.recordings)})]}),(0,a.jsxs)(u.ZP,{item:!0,xs:4,children:[(0,a.jsx)(l.Z,{variant:"subtitle2",color:"textSecondary",children:"Logs"}),(0,a.jsx)(l.Z,{variant:"body1",children:es(F.storage.logs)})]}),(0,a.jsxs)(u.ZP,{item:!0,xs:4,children:[(0,a.jsx)(l.Z,{variant:"subtitle2",color:"textSecondary",children:"Backups"}),(0,a.jsx)(l.Z,{variant:"body1",children:es(F.storage.backups)})]})]})]})]})})]}),(0,a.jsxs)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(B.Z,{sx:{verticalAlign:"middle",mr:1}}),"Uptime: ",(e=F.uptime,"".concat(Math.floor(e/86400),"d ").concat(Math.floor(e%86400/3600),"h ").concat(Math.floor(e%3600/60),"m"))]}),(0,a.jsxs)(l.Z,{children:["Last Update: ",new Date(F.lastUpdate).toLocaleString()]})]})]})}),(0,a.jsx)(u.ZP,{item:!0,xs:12,md:4,children:(0,a.jsxs)(h.Z,{sx:{p:3},children:[(0,a.jsx)(l.Z,{variant:"h6",gutterBottom:!0,children:"Settings"}),(0,a.jsxs)(p.Z,{children:[(0,a.jsxs)(f.ZP,{children:[(0,a.jsx)(Z.Z,{primary:"Automatic Updates",secondary:"Keep the system up to date automatically"}),(0,a.jsx)(y.Z,{children:(0,a.jsx)(v.Z,{edge:"end",checked:K,onChange:e=>V(e.target.checked)})})]}),(0,a.jsxs)(f.ZP,{children:[(0,a.jsx)(Z.Z,{primary:"Log Retention",secondary:"Number of days to keep system logs"}),(0,a.jsx)(y.Z,{children:(0,a.jsx)(w.Z,{type:"number",size:"small",value:H,onChange:e=>q(e.target.value),sx:{width:80}})})]})]}),(0,a.jsx)(i.Z,{sx:{mt:2},children:(0,a.jsx)(d.Z,{variant:"contained",color:"primary",disabled:Q,onClick:()=>Y(),children:"Update Now"})})]})}),(0,a.jsx)(u.ZP,{item:!0,xs:12,children:(0,a.jsxs)(h.Z,{sx:{p:3},children:[(0,a.jsx)(l.Z,{variant:"h6",gutterBottom:!0,children:"Maintenance Logs"}),(0,a.jsx)(p.Z,{children:N.map(e=>(0,a.jsxs)(f.ZP,{children:[(0,a.jsx)(Z.Z,{primary:e.type,secondary:"".concat(new Date(e.timestamp).toLocaleString()," - ").concat(e.details)}),(0,a.jsx)(y.Z,{children:(0,a.jsx)(l.Z,{color:"success"===e.status?"success.main":"error.main",children:e.status})})]},e.id))})]})}),(0,a.jsx)(u.ZP,{item:!0,xs:12,children:(0,a.jsxs)(h.Z,{sx:{p:3},children:[(0,a.jsx)(l.Z,{variant:"h6",gutterBottom:!0,children:"Backup Configuration"}),(0,a.jsxs)(u.ZP,{container:!0,spacing:3,children:[(0,a.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(w.Z,{fullWidth:!0,label:"Backup Schedule (cron)",value:_.schedule,onChange:e=>D({..._,schedule:e.target.value})})}),(0,a.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(w.Z,{fullWidth:!0,type:"number",label:"Retention Days",value:_.retention,onChange:e=>D({..._,retention:parseInt(e.target.value)})})}),(0,a.jsx)(u.ZP,{item:!0,xs:12,children:(0,a.jsx)(w.Z,{fullWidth:!0,label:"Backup Location",value:_.location,onChange:e=>D({..._,location:e.target.value})})})]})]})})]})]}),(0,a.jsxs)(S.Z,{open:W,onClose:()=>z(!1),children:[(0,a.jsx)(b.Z,{children:"Create System Backup"}),(0,a.jsxs)(k.Z,{children:[(0,a.jsxs)(l.Z,{variant:"body2",color:"textSecondary",sx:{mb:2},children:["This will create a backup of all system data including:",(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:"User data and permissions"}),(0,a.jsx)("li",{children:"Face recognition models"}),(0,a.jsx)("li",{children:"System configurations"}),(0,a.jsx)("li",{children:"Access logs"})]})]}),J>0&&(0,a.jsxs)(i.Z,{sx:{mt:2},children:[(0,a.jsx)(j.Z,{variant:"determinate",value:J}),(0,a.jsxs)(l.Z,{variant:"body2",color:"textSecondary",sx:{mt:1},children:["Progress: ",J,"%"]})]})]}),(0,a.jsxs)(P.Z,{children:[(0,a.jsx)(d.Z,{onClick:()=>z(!1),children:"Cancel"}),(0,a.jsx)(d.Z,{onClick:et,variant:"contained",color:"primary",disabled:J>0,children:"Start Backup"})]})]})]})})}var R=s(47907);function U(){let{user:e,isLoading:t}=(0,A.aC)(),s=(0,R.useRouter)();return((0,r.useEffect)(()=>{t||e||s.push("/login")},[e,t,s]),t||!e)?(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,a.jsx)(n.Z,{})}):(0,a.jsx)(T,{})}}},function(e){e.O(0,[463,26,756,355,585,258,206,894,508,818,859,466,891,971,69,744],function(){return e(e.s=11181)}),_N_E=e.O()}]);