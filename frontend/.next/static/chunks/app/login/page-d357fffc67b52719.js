(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{14718:function(e,t,r){Promise.resolve().then(r.bind(r,23218))},2888:function(e,t,r){"use strict";r.d(t,{aC:function(){return a}});var n=r(64090),i=r(84586);function a(){let e=(0,n.useContext)(i.V);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}r(47907)},23218:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return H}});var n=r(3827),i=r(64090),a=r(2888),o=r(47907),s=r(8792),l=r(4598),c=r(54272),d=r(10470),u=r(29835),h=r(72921),f=r(70444),g=r(14749),p=r(75504),m=r(44174),y=r(95135),w=r(58836),x=r(19048),v=r(86170),b=r(43758),j=r(86761),L=r(70533);function Z(e){return(0,L.ZP)("MuiLink",e)}let E=(0,j.Z)("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var k=r(9957),C=r(41869);let P={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},A=e=>P[e]||e;var S=e=>{let{theme:t,ownerState:r}=e,n=A(r.color),i=(0,k.DW)(t,"palette.".concat(n),!1)||r.color,a=(0,k.DW)(t,"palette.".concat(n,"Channel"));return"vars"in t&&a?"rgba(".concat(a," / 0.4)"):(0,C.Fq)(i,.4)};let O=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],T=e=>{let{classes:t,component:r,focusVisible:n,underline:i}=e,a={root:["root","underline".concat((0,y.Z)(i)),"button"===r&&"button",n&&"focusVisible"]};return(0,m.Z)(a,Z,t)},D=(0,w.ZP)(u.Z,{name:"MuiLink",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,t["underline".concat((0,y.Z)(r.underline))],"button"===r.component&&t.button]}})(e=>{let{theme:t,ownerState:r}=e;return(0,g.Z)({},"none"===r.underline&&{textDecoration:"none"},"hover"===r.underline&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},"always"===r.underline&&(0,g.Z)({textDecoration:"underline"},"inherit"!==r.color&&{textDecorationColor:S({theme:t,ownerState:r})},{"&:hover":{textDecorationColor:"inherit"}}),"button"===r.component&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},["&.".concat(E.focusVisible)]:{outline:"auto"}})}),R=i.forwardRef(function(e,t){let r=(0,x.i)({props:e,name:"MuiLink"}),{className:a,color:o="primary",component:s="a",onBlur:l,onFocus:c,TypographyClasses:d,underline:u="always",variant:h="inherit",sx:m}=r,y=(0,f.Z)(r,O),{isFocusVisibleRef:w,onBlur:j,onFocus:L,ref:Z}=(0,v.Z)(),[E,k]=i.useState(!1),C=(0,b.Z)(t,Z),A=(0,g.Z)({},r,{color:o,component:s,focusVisible:E,underline:u,variant:h}),S=T(A);return(0,n.jsx)(D,(0,g.Z)({color:o,className:(0,p.Z)(S.root,a),classes:d,component:s,onBlur:e=>{j(e),!1===w.current&&k(!1),l&&l(e)},onFocus:e=>{L(e),!0===w.current&&k(!0),c&&c(e)},ref:C,ownerState:A,variant:h,sx:[...Object.keys(P).includes(o)?[]:[{color:o}],...Array.isArray(m)?m:[m]]},y))});var W=r(6285),F=r(66910);let N=()=>{let{login:e,loginWithFace:t}=(0,a.aC)(),[r,f]=(0,i.useState)(!1),[g,p]=(0,i.useState)(null),m=(0,o.useRouter)();(0,i.useRef)(null);let[y,w]=(0,i.useState)({email:"",password:""}),x=e=>{let{name:t,value:r}=e.target;w(e=>({...e,[t]:r}))},v=async t=>{t.preventDefault(),p(null),f(!0);try{await e(y),m.push("/dashboard")}catch(e){p("Login failed. Please check your credentials.")}finally{f(!1)}},b=async()=>{p(null),f(!0);try{let e=await navigator.mediaDevices.getUserMedia({video:!0}),r=document.createElement("video");r.srcObject=e,await r.play();let n=document.createElement("canvas");n.width=r.videoWidth,n.height=r.videoHeight;let i=n.getContext("2d");if(!i)throw Error("Could not get canvas context");i.drawImage(r,0,0,n.width,n.height),e.getTracks().forEach(e=>e.stop());let a=n.toDataURL("image/jpeg");await t(a),m.push("/dashboard")}catch(e){p("Face login failed. Please try again or use email/password.")}finally{f(!1)}};return(0,n.jsx)(l.Z,{maxWidth:"sm",children:(0,n.jsx)(c.Z,{sx:{mt:8},children:(0,n.jsxs)(d.Z,{sx:{p:4},children:[(0,n.jsx)(u.Z,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Login"}),g&&(0,n.jsx)(u.Z,{color:"error",align:"center",gutterBottom:!0,children:g}),(0,n.jsxs)("form",{onSubmit:v,children:[(0,n.jsx)(h.Z,{fullWidth:!0,margin:"normal",label:"Email",name:"email",type:"email",value:y.email,onChange:x,disabled:r,required:!0}),(0,n.jsx)(h.Z,{fullWidth:!0,margin:"normal",label:"Password",name:"password",type:"password",value:y.password,onChange:x,disabled:r,required:!0}),(0,n.jsx)(c.Z,{sx:{mt:1,mb:2,textAlign:"right"},children:(0,n.jsx)(s.default,{href:"/forgot-password",passHref:!0,children:(0,n.jsx)(R,{variant:"body2",children:"Forgot password?"})})}),(0,n.jsxs)(c.Z,{sx:{mt:3,display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsx)(W.Z,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:r,children:r?(0,n.jsx)(F.Z,{size:24}):"Login with Email"}),(0,n.jsx)(W.Z,{type:"button",variant:"outlined",color:"primary",fullWidth:!0,onClick:b,disabled:r,children:r?(0,n.jsx)(F.Z,{size:24}):"Login with Face"})]})]})]})})})};function H(){return(0,n.jsx)(l.Z,{maxWidth:"sm",children:(0,n.jsx)(c.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)(N,{})})})}},84586:function(e,t,r){"use strict";r.d(t,{H:function(){return s},V:function(){return o}});var n=r(3827),i=r(64090),a=r(47907);let o=(0,i.createContext)(null);function s(e){let{children:t}=e,r=(0,a.useRouter)(),[s,l]=(0,i.useState)({user:null,isAuthenticated:!1,isLoading:!0,error:null}),c=e=>{l(t=>({...t,error:e}))},d=async e=>{try{c(null),l(e=>({...e,isLoading:!0})),l(t=>({...t,user:e,isAuthenticated:!0,isLoading:!1})),r.push("/dashboard")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Login failed"})),e}},u=async e=>{try{var t;c(null),l(e=>({...e,isLoading:!0}));let n=await fetch("/api/auth/login/face",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({faceData:e})});if(!n.ok)throw Error("Face recognition login failed");let i=await n.json();if(!i.success||!(null===(t=i.data)||void 0===t?void 0:t.user))throw Error(i.error||"Face recognition login failed");l(e=>({...e,user:i.data.user,isAuthenticated:!0,isLoading:!1})),r.push("/dashboard")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Face recognition login failed"})),e}},h=async e=>{try{var t;c(null),l(e=>({...e,isLoading:!0}));let n=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!n.ok)throw Error("Registration failed");let i=await n.json();if(!i.success||!(null===(t=i.data)||void 0===t?void 0:t.user))throw Error(i.error||"Registration failed");l(e=>({...e,user:i.data.user,isAuthenticated:!0,isLoading:!1})),r.push("/dashboard")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Registration failed"})),e}},f=async()=>{try{c(null),l(e=>({...e,isLoading:!0})),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),l({user:null,isAuthenticated:!1,isLoading:!1,error:null}),r.push("/login")}catch(e){l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Logout failed"}))}},g=async e=>{try{c(null),l(e=>({...e,isLoading:!0}));let t=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});if(!t.ok)throw Error("Password reset failed");let r=await t.json();if(!r.success)throw Error(r.error||"Password reset failed");l(e=>({...e,isLoading:!1}))}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password reset failed"})),e}},p=async(e,t,n)=>{try{c(null),l(e=>({...e,isLoading:!0}));let i=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:t,confirmPassword:n})});if(!i.ok)throw Error("Password update failed");let a=await i.json();if(!a.success)throw Error(a.error||"Password update failed");l(e=>({...e,isLoading:!1})),r.push("/login")}catch(e){throw l(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Password update failed"})),e}};(0,i.useEffect)(()=>{!async function(){try{var e;let t=await fetch("/api/auth/me",{method:"GET",credentials:"include"});if(!t.ok)throw Error("Authentication check failed");let r=await t.json();r.success&&(null===(e=r.data)||void 0===e?void 0:e.user)?l({user:r.data.user,isAuthenticated:!0,isLoading:!1,error:null}):l({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(e){l({user:null,isAuthenticated:!1,isLoading:!1,error:e instanceof Error?e.message:"Authentication check failed"})}}()},[]);let m={...s,login:d,loginWithFace:u,register:h,logout:f,resetPassword:g,updatePassword:p};return(0,n.jsx)(o.Provider,{value:m,children:t})}}},function(e){e.O(0,[463,26,756,355,585,258,206,792,971,69,744],function(){return e(e.s=14718)}),_N_E=e.O()}]);