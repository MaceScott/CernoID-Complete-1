"use strict";(()=>{var e={};e.id=540,e.ids=[540],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},93241:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>v,patchFetch:()=>P,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>j,staticGenerationBailout:()=>b});var s={};t.r(s),t.d(s,{DELETE:()=>g,GET:()=>m,POST:()=>z,PUT:()=>y});var n=t(95419),i=t(69108),a=t(99678),o=t(78070),u=t(82196),c=t(40489),l=t(76971),p=t(50701);let d=p.XT.extend({role:u.z.string().optional(),resource:u.z.string().optional(),location:u.z.string().optional()});async function m(e){return(0,p.c2)(e,async r=>{let t=(0,p.O5)(e,d),{page:s,limit:n}=t,i={...t.role&&{role:t.role},...t.resource&&{resource:t.resource},...t.location&&{location:t.location}},[a,u]=await Promise.all([c._.permission.count({where:i}),c._.permission.findMany({where:i,take:n,skip:(s-1)*n,orderBy:{createdAt:"desc"}})]);return o.Z.json({success:!0,data:(0,p.NR)(u,a,t)},{status:200})})}async function z(e){return(0,p.c2)(e,async r=>{let t=await e.json(),s=l.Iy.parse(t);if(await c._.permission.findFirst({where:{value:s.value,type:s.type}}))return o.Z.json({success:!1,error:"Permission already exists"},{status:409});try{let e=await c._.permission.create({data:{...s,createdBy:r.id,updatedBy:r.id}});return o.Z.json({success:!0,data:e},{status:201})}catch(e){return o.Z.json({success:!1,error:"Failed to create permission"},{status:500})}})}async function y(e){return(0,p.c2)(e,async r=>{let{id:t,...s}=await e.json();if(!t)return o.Z.json({success:!1,error:"Permission ID is required"},{status:400});let n=l.Iy.parse(s);try{let e=await c._.permission.update({where:{id:t},data:{...n,updatedBy:r.id}});return o.Z.json({success:!0,data:e},{status:200})}catch(e){return o.Z.json({success:!1,error:"Failed to update permission"},{status:500})}})}async function g(e){return(0,p.c2)(e,async()=>{let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return o.Z.json({success:!1,error:"Permission ID is required"},{status:400});try{return await c._.permission.delete({where:{id:t}}),o.Z.json({success:!0,message:"Permission deleted successfully"},{status:200})}catch(e){return o.Z.json({success:!1,error:"Failed to delete permission"},{status:500})}})}let f=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/security/permissions/route",pathname:"/api/security/permissions",filename:"route",bundlePath:"app/api/security/permissions/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\permissions\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:j,serverHooks:w,headerHooks:x,staticGenerationBailout:b}=f,v="/api/security/permissions/route";function P(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:j})}},50701:(e,r,t)=>{t.d(r,{XT:()=>o,NR:()=>c,O5:()=>u,c2:()=>m,QO:()=>d});var s=t(78070),n=t(82196),i=t(36929);async function a(e){return await (0,i.getToken)({req:e})}let o=n.z.object({page:n.z.coerce.number().min(1).default(1),limit:n.z.coerce.number().min(1).max(100).default(10),sort:n.z.string().optional(),order:n.z.enum(["asc","desc"]).optional(),search:n.z.string().optional()});function u(e,r){let t=Object.fromEntries(e.nextUrl.searchParams);return r.parse(t)}function c(e,r,t){let{page:s,limit:n}=t;return{items:e,total:r,page:s,limit:n,pages:Math.ceil(r/n)}}function l(e){return e instanceof n.jm?s.Z.json({success:!1,error:"Validation error",data:e.errors},{status:400}):e instanceof Error?s.Z.json({success:!1,error:e.message},{status:500}):s.Z.json({success:!1,error:"An unexpected error occurred"},{status:500})}function p(e,r=400){return s.Z.json({success:!1,error:e},{status:r})}async function d(e,r){try{let t=await a(e);if(!t)return p("Unauthorized",401);return await r(t)}catch(e){return l(e)}}async function m(e,r){try{let t=await a(e);if(!t)return p("Unauthorized",401);if(!t.isAdmin)return p("Forbidden",403);return await r(t)}catch(e){return l(e)}}},76971:(e,r,t)=>{t.d(r,{Iy:()=>i,O:()=>n});var s=t(82196);let n=s.z.object({id:s.z.string().optional(),type:s.z.string(),severity:s.z.enum(["low","medium","high"]),message:s.z.string(),timestamp:s.z.string().datetime().optional(),cameraId:s.z.string().optional(),zoneId:s.z.string().optional(),userId:s.z.string().optional(),metadata:s.z.record(s.z.unknown()).optional()}),i=s.z.object({id:s.z.string().optional(),name:s.z.string(),description:s.z.string().optional(),type:s.z.enum(["role","zone","feature"]),value:s.z.string(),metadata:s.z.record(s.z.unknown()).optional()});s.z.object({id:s.z.string().optional(),name:s.z.string(),description:s.z.string().optional(),level:s.z.number().min(0).max(10),parent_id:s.z.string().optional(),metadata:s.z.record(s.z.unknown()).optional(),cameras:s.z.array(s.z.string()).optional(),allowedRoles:s.z.array(s.z.string()).optional(),allowedUsers:s.z.array(s.z.string()).optional(),schedules:s.z.array(s.z.object({days:s.z.array(s.z.number().min(0).max(6)),start:s.z.string(),end:s.z.string()})).optional()})},40489:(e,r,t)=>{t.d(r,{_:()=>n});let s=require("@prisma/client"),n=global.prisma||new s.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,206,929,196],()=>t(93241));module.exports=s})();