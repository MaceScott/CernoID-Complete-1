"use strict";(()=>{var e={};e.id=540,e.ids=[540],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},8709:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},3477:e=>{e.exports=require("querystring")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},3241:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>v,originalPathname:()=>Z,patchFetch:()=>L,requestAsyncStorage:()=>A,routeModule:()=>f,serverHooks:()=>P,staticGenerationAsyncStorage:()=>q,staticGenerationBailout:()=>j});var t={};s.r(t),s.d(t,{DELETE:()=>g,GET:()=>y,POST:()=>h,PUT:()=>x});var i=s(5419),a=s(9108),o=s(9678),n=s(8070),u=s(2196),l=s(1906),c=s(2002),d=s(2177),p=s(9605),m=s(9099);let w=d.PaginationSchema.extend({role:u.z.string().optional(),resource:u.z.string().optional(),location:u.z.string().optional()});async function y(e){return(0,d.withAdminAuth)(async()=>{let{searchParams:r}=new URL(e.url),s=(0,d.parseQueryParams)(r,w),t={...s.role&&{role:s.role},...s.resource&&{resource:s.resource},...s.location&&{location:s.location}},[i,a]=await Promise.all([l._.permission.count({where:t}),l._.permission.findMany({where:t,take:s.limit||10,skip:s.offset||0,orderBy:{createdAt:"desc"}})]);return(0,d.buildPaginationResponse)(a,i,s.limit||10,s.offset||0)})}async function h(e){return(0,d.withAdminAuth)(async r=>{let s=await e.json(),t=c.PermissionSchema.parse(s);if(await l._.permission.findFirst({where:{role:t.role,resource:t.resource,action:t.action,location:t.location}}))throw Error("Permission already exists");try{let e=await (0,p.Z1)(m.L);if(!e?.user)return n.Z.json({error:"Unauthorized"},{status:401});let r=await l._.permission.create({data:{...t,createdBy:e.user.id,updatedBy:e.user.id}});return n.Z.json(r,{status:201})}catch(e){return console.error("Failed to create permission:",e),n.Z.json({error:"Failed to create permission"},{status:500})}})}async function x(e){return(0,d.withAdminAuth)(async r=>{let{id:s,...t}=await e.json();if(!s)throw Error("Permission ID is required");let i=c.PermissionSchema.parse(t),a=await (0,p.Z1)(m.L);if(!a?.user)return n.Z.json({error:"Unauthorized"},{status:401});try{let e=await l._.permission.update({where:{id:s},data:{...i,updatedBy:a.user.id}});return n.Z.json({data:e},{status:200})}catch(e){return n.Z.json({error:"Failed to update permission"},{status:500})}})}async function g(e){return(0,d.withAdminAuth)(async()=>{let{searchParams:r}=new URL(e.url),s=r.get("id");if(!s)throw Error("Permission ID is required");return await l._.permission.delete({where:{id:s}}),{message:"Permission deleted successfully"}})}let f=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/security/permissions/route",pathname:"/api/security/permissions",filename:"route",bundlePath:"app/api/security/permissions/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\permissions\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:A,staticGenerationAsyncStorage:q,serverHooks:P,headerHooks:v,staticGenerationBailout:j}=f,Z="/api/security/permissions/route";function L(){return(0,o.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:q})}},2177:(e,r,s)=>{s(8070)},2002:(e,r,s)=>{s(6929)},9099:(e,r,s)=>{s.d(r,{L:()=>o});var t=s(6485),i=s(1906),a=s(6521);let o={providers:[(0,t.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await i._.user.findUnique({where:{email:e.email}});return r&&await (0,a.compare)(e.password,r.password)?{id:r.id,username:r.username,email:r.email,name:r.name,role:r.role,status:r.status,isAdmin:r.isAdmin,accessLevel:r.accessLevel,allowedZones:r.allowedZones,lastLogin:r.lastLogin,createdAt:r.createdAt,updatedAt:r.updatedAt}:null}})],session:{strategy:"jwt"},pages:{signIn:"/login",error:"/login"},callbacks:{session:async({session:e,token:r})=>({...e,user:{...e.user,id:r.sub,role:r.role,status:r.status,isAdmin:r.isAdmin,accessLevel:r.accessLevel,allowedZones:r.allowedZones,username:r.username}}),jwt:async({token:e,user:r})=>(r&&(e.role=r.role,e.status=r.status,e.isAdmin=r.isAdmin,e.accessLevel=r.accessLevel,e.allowedZones=r.allowedZones,e.username=r.username),e)}}},1906:(e,r,s)=>{s.d(r,{_:()=>i});let t=require("@prisma/client"),i=global.prisma||new t.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[52,765,929,870],()=>s(3241));module.exports=t})();