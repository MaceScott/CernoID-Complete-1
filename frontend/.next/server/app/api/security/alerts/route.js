"use strict";(()=>{var e={};e.id=648,e.ids=[648],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},74937:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>j,originalPathname:()=>v,patchFetch:()=>_,requestAsyncStorage:()=>h,routeModule:()=>w,serverHooks:()=>T,staticGenerationAsyncStorage:()=>z,staticGenerationBailout:()=>q});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>m,POST:()=>f,PUT:()=>y});var a=r(95419),n=r(69108),i=r(99678),u=r(78070),o=r(82196),c=r(40489),d=r(50701);let l=o.z.object({title:o.z.string().min(1),description:o.z.string().optional(),severity:o.z.enum(["low","medium","high","critical"]),status:o.z.enum(["open","acknowledged","resolved","false_positive"]),sourceType:o.z.enum(["camera","access_point","manual"]),sourceId:o.z.string().optional(),metadata:o.z.record(o.z.unknown()).optional(),assignedTo:o.z.string().optional()}),p=d.XT.extend({status:o.z.enum(["open","acknowledged","resolved","false_positive"]).optional(),severity:o.z.enum(["low","medium","high","critical"]).optional(),sourceType:o.z.enum(["camera","access_point","manual"]).optional(),sourceId:o.z.string().optional(),assignedTo:o.z.string().optional(),startDate:o.z.string().datetime().optional(),endDate:o.z.string().datetime().optional()});async function m(e){return(0,d.QO)(e,async t=>{let r=(0,d.O5)(e,p),{page:s,limit:a}=r,n={...r.status&&{status:r.status},...r.severity&&{severity:r.severity},...r.sourceType&&{sourceType:r.sourceType},...r.sourceId&&{sourceId:r.sourceId},...r.assignedTo&&{assignedTo:r.assignedTo},...r.startDate&&r.endDate&&{createdAt:{gte:new Date(r.startDate),lte:new Date(r.endDate)}}},[i,o]=await Promise.all([c._.alert.count({where:n}),c._.alert.findMany({where:n,take:a,skip:(s-1)*a,orderBy:{createdAt:"desc"},include:{assignedUser:{select:{id:!0,name:!0,email:!0}}}})]);return u.Z.json({success:!0,data:(0,d.NR)(o,i,r)},{status:200})})}async function f(e){return(0,d.QO)(e,async t=>{let r=await e.json(),s=l.parse(r);if(s.sourceId&&!await (async()=>{switch(s.sourceType){case"camera":return c._.camera.findUnique({where:{id:s.sourceId}});case"access_point":return c._.accessPoint.findUnique({where:{id:s.sourceId}});default:return null}})())return u.Z.json({success:!1,error:`${s.sourceType} not found`},{status:404});if(s.assignedTo&&!await c._.user.findUnique({where:{id:s.assignedTo}}))return u.Z.json({success:!1,error:"Assigned user not found"},{status:404});try{let e=await c._.alert.create({data:{...s,createdBy:t.id,updatedBy:t.id},include:{assignedUser:{select:{id:!0,name:!0,email:!0}}}});return u.Z.json({success:!0,data:e},{status:201})}catch(e){return u.Z.json({success:!1,error:"Failed to create alert"},{status:500})}})}async function y(e){return(0,d.QO)(e,async t=>{let{id:r,...s}=await e.json();if(!r)return u.Z.json({success:!1,error:"Alert ID is required"},{status:400});let a=l.parse(s);if(a.sourceId&&!await (async()=>{switch(a.sourceType){case"camera":return c._.camera.findUnique({where:{id:a.sourceId}});case"access_point":return c._.accessPoint.findUnique({where:{id:a.sourceId}});default:return null}})())return u.Z.json({success:!1,error:`${a.sourceType} not found`},{status:404});if(a.assignedTo&&!await c._.user.findUnique({where:{id:a.assignedTo}}))return u.Z.json({success:!1,error:"Assigned user not found"},{status:404});try{let e=await c._.alert.update({where:{id:r},data:{...a,updatedBy:t.id},include:{assignedUser:{select:{id:!0,name:!0,email:!0}}}});return u.Z.json({success:!0,data:e},{status:200})}catch(e){return u.Z.json({success:!1,error:"Failed to update alert"},{status:500})}})}async function g(e){return(0,d.QO)(e,async()=>{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return u.Z.json({success:!1,error:"Alert ID is required"},{status:400});try{return await c._.alert.delete({where:{id:r}}),u.Z.json({success:!0,message:"Alert deleted successfully"},{status:200})}catch(e){return u.Z.json({success:!1,error:"Failed to delete alert"},{status:500})}})}let w=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/security/alerts/route",pathname:"/api/security/alerts",filename:"route",bundlePath:"app/api/security/alerts/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\alerts\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:z,serverHooks:T,headerHooks:j,staticGenerationBailout:q}=w,v="/api/security/alerts/route";function _(){return(0,i.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:z})}},50701:(e,t,r)=>{r.d(t,{XT:()=>u,NR:()=>c,O5:()=>o,c2:()=>m,QO:()=>p});var s=r(78070),a=r(82196),n=r(36929);async function i(e){return await (0,n.getToken)({req:e})}let u=a.z.object({page:a.z.coerce.number().min(1).default(1),limit:a.z.coerce.number().min(1).max(100).default(10),sort:a.z.string().optional(),order:a.z.enum(["asc","desc"]).optional(),search:a.z.string().optional()});function o(e,t){let r=Object.fromEntries(e.nextUrl.searchParams);return t.parse(r)}function c(e,t,r){let{page:s,limit:a}=r;return{items:e,total:t,page:s,limit:a,pages:Math.ceil(t/a)}}function d(e){return e instanceof a.jm?s.Z.json({success:!1,error:"Validation error",data:e.errors},{status:400}):e instanceof Error?s.Z.json({success:!1,error:e.message},{status:500}):s.Z.json({success:!1,error:"An unexpected error occurred"},{status:500})}function l(e,t=400){return s.Z.json({success:!1,error:e},{status:t})}async function p(e,t){try{let r=await i(e);if(!r)return l("Unauthorized",401);return await t(r)}catch(e){return d(e)}}async function m(e,t){try{let r=await i(e);if(!r)return l("Unauthorized",401);if(!r.isAdmin)return l("Forbidden",403);return await t(r)}catch(e){return d(e)}}},40489:(e,t,r)=>{r.d(t,{_:()=>a});let s=require("@prisma/client"),a=global.prisma||new s.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206,929,196],()=>r(74937));module.exports=s})();