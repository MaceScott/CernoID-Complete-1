"use strict";(()=>{var e={};e.id=648,e.ids=[648],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4937:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>I,originalPathname:()=>z,patchFetch:()=>P,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>A,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>D});var a={};r.r(a),r.d(a,{DELETE:()=>h,GET:()=>m,POST:()=>y,PUT:()=>w});var s=r(5419),i=r(9108),n=r(9678),o=r(8070),u=r(2196),d=r(1906),l=r(2177);let c=u.z.object({type:u.z.string(),severity:u.z.string(),message:u.z.string(),status:u.z.enum(["open","resolved","dismissed"]).default("open"),cameraId:u.z.string().optional(),resolvedAt:u.z.date().optional(),resolvedBy:u.z.string().optional()}),p=l.PaginationSchema.extend({type:u.z.string().optional(),severity:u.z.string().optional(),status:u.z.enum(["open","resolved","dismissed"]).optional(),cameraId:u.z.string().optional(),userId:u.z.string().optional(),startDate:u.z.string().optional(),endDate:u.z.string().optional()});async function m(e){return(0,l.withAuth)(async()=>{let{searchParams:t}=new URL(e.url),r=(0,l.parseQueryParams)(t,p),a={...r.type&&{type:r.type},...r.severity&&{severity:r.severity},...r.status&&{status:r.status},...r.cameraId&&{cameraId:r.cameraId},...r.userId&&{userId:r.userId},...r.startDate&&{createdAt:{gte:new Date(r.startDate)}},...r.endDate&&{createdAt:{...r.startDate&&{gte:new Date(r.startDate)}||{},lte:new Date(r.endDate)}}},[s,i]=await Promise.all([d._.alert.count({where:a}),d._.alert.findMany({where:a,take:r.limit||10,skip:r.offset||0,orderBy:{createdAt:"desc"},include:{camera:{select:{id:!0,name:!0,type:!0,location:!0,status:!0}},user:{select:{id:!0,name:!0,email:!0}}}})]);return(0,l.buildPaginationResponse)(i,s,r.limit||10,r.offset||0)})}async function y(e){return(0,l.withAuth)(async t=>{if(!t)throw Error("User is required");let r=await e.json(),a=c.parse(r);if(a.cameraId&&!await d._.camera.findUnique({where:{id:a.cameraId}}))throw Error("Camera not found");let s=await d._.alert.create({data:{...a,userId:t.id},include:{camera:{select:{id:!0,name:!0,type:!0,location:!0,status:!0}},user:{select:{id:!0,name:!0,email:!0}}}});return o.Z.json(s,{status:201})})}async function w(e){return(0,l.withAuth)(async t=>{if(!t)throw Error("User is required");let{id:r,...a}=await e.json();if(!r)throw Error("Alert ID is required");let s=c.parse(a);if(s.cameraId&&!await d._.camera.findUnique({where:{id:s.cameraId}}))throw Error("Camera not found");return"resolved"!==s.status||s.resolvedAt||(s.resolvedAt=new Date,s.resolvedBy=t.id),await d._.alert.update({where:{id:r},data:s,include:{camera:{select:{id:!0,name:!0,type:!0,location:!0,status:!0}},user:{select:{id:!0,name:!0,email:!0}}}})})}async function h(e){return(0,l.withAdminAuth)(async()=>{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)throw Error("Alert ID is required");return await d._.alert.delete({where:{id:r}}),{message:"Alert deleted successfully"}})}let f=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/security/alerts/route",pathname:"/api/security/alerts",filename:"route",bundlePath:"app/api/security/alerts/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\alerts\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:A,headerHooks:I,staticGenerationBailout:D}=f,z="/api/security/alerts/route";function P(){return(0,n.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:v})}},2177:(e,t,r)=>{r(8070)},1906:(e,t,r)=>{r.d(t,{_:()=>s});let a=require("@prisma/client"),s=global.prisma||new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[52,765],()=>r(4937));module.exports=a})();