"use strict";(()=>{var e={};e.id=179,e.ids=[179],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8709:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},4610:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>x,patchFetch:()=>E,requestAsyncStorage:()=>P,routeModule:()=>f,serverHooks:()=>q,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>z});var i={};r.r(i),r.d(i,{DELETE:()=>w,GET:()=>h,POST:()=>m,PUT:()=>y});var n=r(5419),a=r(9108),s=r(9678),o=r(8070),c=r(2196),u=r(1906),l=r(2002),d=r(2177);let p=d.PaginationSchema.extend({name:c.z.string().optional(),level:c.z.string().transform(Number).optional(),location:c.z.string().optional()});async function h(e){return(0,d.withAdminAuth)(async()=>{let{searchParams:t}=new URL(e.url),r=(0,d.parseQueryParams)(t,p),i={...r.name&&{name:{contains:r.name}},...r.level&&{level:r.level},...r.location&&{locations:{has:r.location}}},[n,a]=await Promise.all([u._.securityZone.count({where:i}),u._.securityZone.findMany({where:i,take:r.limit||10,skip:r.offset||0,orderBy:{name:"asc"},include:{cameras:{select:{id:!0,name:!0,type:!0,status:!0}},accessPoints:{select:{id:!0,name:!0,type:!0,status:!0}},children:{select:{id:!0,name:!0,level:!0}},parent:{select:{id:!0,name:!0,level:!0}}}})]);return(0,d.buildPaginationResponse)(a,n,r.limit||10,r.offset||0)})}async function m(e){return(0,d.withAdminAuth)(async t=>{if(!t)throw Error("User is required");let r=await e.json(),i=l.SecurityZoneSchema.parse(r);if(await u._.securityZone.findFirst({where:{name:i.name,locations:{hasEvery:i.locations}}}))throw Error("Security zone already exists for these locations");let n=await u._.securityZone.create({data:{...i,createdBy:t.id,updatedBy:t.id},include:{cameras:!0,accessPoints:!0,children:!0,parent:!0}});return o.Z.json(n,{status:201})})}async function y(e){return(0,d.withAdminAuth)(async t=>{if(!t)throw Error("User is required");let{id:r,...i}=await e.json();if(!r)throw Error("Security zone ID is required");let n=l.SecurityZoneSchema.parse(i);if(n.parentZoneId){let e=await u._.securityZone.findUnique({where:{id:n.parentZoneId},include:{parent:!0}});if(e?.id===r||e?.parent?.id===r)throw Error("Circular parent-child relationship detected")}return await u._.securityZone.update({where:{id:r},data:{...n,updatedBy:t.id},include:{cameras:!0,accessPoints:!0,children:!0,parent:!0}})})}async function w(e){return(0,d.withAdminAuth)(async()=>{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)throw Error("Security zone ID is required");let i=await u._.securityZone.findUnique({where:{id:r},include:{children:!0,cameras:!0,accessPoints:!0}});if(i?.children.length)throw Error("Cannot delete zone with child zones");if(i?.cameras.length||i?.accessPoints.length)throw Error("Cannot delete zone with associated devices");return await u._.securityZone.delete({where:{id:r}}),{message:"Security zone deleted successfully"}})}let f=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/security/zones/route",pathname:"/api/security/zones",filename:"route",bundlePath:"app/api/security/zones/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\zones\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:P,staticGenerationAsyncStorage:g,serverHooks:q,headerHooks:v,staticGenerationBailout:z}=f,x="/api/security/zones/route";function E(){return(0,s.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:g})}},2177:(e,t,r)=>{r(8070)},2002:(e,t,r)=>{r(6929)},1906:(e,t,r)=>{r.d(t,{_:()=>n});let i=require("@prisma/client"),n=global.prisma||new i.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[52,765,929],()=>r(4610));module.exports=i})();