"use strict";(()=>{var e={};e.id=179,e.ids=[179],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},64610:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>x,patchFetch:()=>q,requestAsyncStorage:()=>Z,routeModule:()=>z,serverHooks:()=>j,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>g});var n={};r.r(n),r.d(n,{DELETE:()=>h,GET:()=>f,POST:()=>y,PUT:()=>m});var s=r(95419),a=r(69108),o=r(99678),i=r(78070),u=r(82196),c=r(40489),l=r(50701);let d=u.z.object({name:u.z.string().min(1),level:u.z.number().int().min(0),description:u.z.string().optional(),parentId:u.z.string().optional(),metadata:u.z.record(u.z.unknown()).optional(),allowedRoles:u.z.array(u.z.string()).optional(),allowedUsers:u.z.array(u.z.string()).optional()}),p=l.XT.extend({level:u.z.number().int().min(0).optional(),parentId:u.z.string().optional()});async function f(e){return(0,l.QO)(e,async t=>{let r=(0,l.O5)(e,p),{page:n,limit:s}=r,a={...void 0!==r.level&&{level:r.level},...r.parentId&&{parentId:r.parentId}},[o,u]=await Promise.all([c._.securityZone.count({where:a}),c._.securityZone.findMany({where:a,take:s,skip:(n-1)*s,orderBy:{level:"asc"},include:{parent:{select:{id:!0,name:!0,level:!0}},children:{select:{id:!0,name:!0,level:!0}}}})]);return i.Z.json({success:!0,data:(0,l.NR)(u,o,r)},{status:200})})}async function y(e){return(0,l.QO)(e,async t=>{let r=await e.json(),n=d.parse(r);if(n.parentId){let e=await c._.securityZone.findUnique({where:{id:n.parentId}});if(!e)return i.Z.json({success:!1,error:"Parent zone not found"},{status:404});if(n.level<=e.level)return i.Z.json({success:!1,error:"Child zone level must be greater than parent zone level"},{status:400})}try{let e=await c._.securityZone.create({data:{...n,createdBy:t.id,updatedBy:t.id},include:{parent:{select:{id:!0,name:!0,level:!0}}}});return i.Z.json({success:!0,data:e},{status:201})}catch(e){return i.Z.json({success:!1,error:"Failed to create security zone"},{status:500})}})}async function m(e){return(0,l.QO)(e,async t=>{let{id:r,...n}=await e.json();if(!r)return i.Z.json({success:!1,error:"Zone ID is required"},{status:400});let s=d.parse(n);if(s.parentId){let e=await c._.securityZone.findUnique({where:{id:s.parentId}});if(!e)return i.Z.json({success:!1,error:"Parent zone not found"},{status:404});if(s.level<=e.level)return i.Z.json({success:!1,error:"Child zone level must be greater than parent zone level"},{status:400})}try{let e=await c._.securityZone.update({where:{id:r},data:{...s,updatedBy:t.id},include:{parent:{select:{id:!0,name:!0,level:!0}}}});return i.Z.json({success:!0,data:e},{status:200})}catch(e){return i.Z.json({success:!1,error:"Failed to update security zone"},{status:500})}})}async function h(e){return(0,l.QO)(e,async()=>{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.Z.json({success:!1,error:"Zone ID is required"},{status:400});let n=await c._.securityZone.findUnique({where:{id:r},include:{children:!0,cameras:!0,accessPoints:!0}});if(!n)return i.Z.json({success:!1,error:"Zone not found"},{status:404});if(n.children.length>0)return i.Z.json({success:!1,error:"Cannot delete zone with child zones"},{status:400});if(n.cameras.length>0||n.accessPoints.length>0)return i.Z.json({success:!1,error:"Cannot delete zone with associated devices"},{status:400});try{return await c._.securityZone.delete({where:{id:r}}),i.Z.json({success:!0,message:"Zone deleted successfully"},{status:200})}catch(e){return i.Z.json({success:!1,error:"Failed to delete security zone"},{status:500})}})}let z=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/security/zones/route",pathname:"/api/security/zones",filename:"route",bundlePath:"app/api/security/zones/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\zones\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:Z,staticGenerationAsyncStorage:v,serverHooks:j,headerHooks:w,staticGenerationBailout:g}=z,x="/api/security/zones/route";function q(){return(0,o.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:v})}},50701:(e,t,r)=>{r.d(t,{XT:()=>i,NR:()=>c,O5:()=>u,c2:()=>f,QO:()=>p});var n=r(78070),s=r(82196),a=r(36929);async function o(e){return await (0,a.getToken)({req:e})}let i=s.z.object({page:s.z.coerce.number().min(1).default(1),limit:s.z.coerce.number().min(1).max(100).default(10),sort:s.z.string().optional(),order:s.z.enum(["asc","desc"]).optional(),search:s.z.string().optional()});function u(e,t){let r=Object.fromEntries(e.nextUrl.searchParams);return t.parse(r)}function c(e,t,r){let{page:n,limit:s}=r;return{items:e,total:t,page:n,limit:s,pages:Math.ceil(t/s)}}function l(e){return e instanceof s.jm?n.Z.json({success:!1,error:"Validation error",data:e.errors},{status:400}):e instanceof Error?n.Z.json({success:!1,error:e.message},{status:500}):n.Z.json({success:!1,error:"An unexpected error occurred"},{status:500})}function d(e,t=400){return n.Z.json({success:!1,error:e},{status:t})}async function p(e,t){try{let r=await o(e);if(!r)return d("Unauthorized",401);return await t(r)}catch(e){return l(e)}}async function f(e,t){try{let r=await o(e);if(!r)return d("Unauthorized",401);if(!r.isAdmin)return d("Forbidden",403);return await t(r)}catch(e){return l(e)}}},40489:(e,t,r)=>{r.d(t,{_:()=>s});let n=require("@prisma/client"),s=global.prisma||new n.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206,929,196],()=>r(64610));module.exports=n})();