"use strict";(()=>{var e={};e.id=391,e.ids=[391],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},8881:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>Z,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>w,staticGenerationAsyncStorage:()=>j,staticGenerationBailout:()=>v});var a={};r.r(a),r.d(a,{DELETE:()=>f,GET:()=>m,POST:()=>y,PUT:()=>z});var s=r(95419),n=r(69108),o=r(99678),i=r(78070),c=r(82196),u=r(40489),d=r(50701);let l=c.z.object({name:c.z.string(),type:c.z.string(),location:c.z.string(),status:c.z.enum(["active","inactive","maintenance"]),zoneId:c.z.string(),settings:c.z.any().optional()}),p=d.XT.extend({name:c.z.string().optional(),type:c.z.string().optional(),location:c.z.string().optional(),status:c.z.enum(["active","inactive","maintenance"]).optional(),zoneId:c.z.string().optional(),zone:c.z.string().optional()});async function m(e){return(0,d.QO)(e,async t=>{let r=(0,d.O5)(e,p),{page:a,limit:s}=r,n={...r.name&&{name:{contains:r.name}},...r.type&&{type:r.type},...r.location&&{location:r.location},...r.status&&{status:r.status},...r.zoneId&&{zoneId:r.zoneId},...r.zone&&{zoneId:r.zone}},[o,c]=await Promise.all([u._.camera.count({where:n}),u._.camera.findMany({where:n,take:s,skip:(a-1)*s,orderBy:{createdAt:"desc"},include:{zone:{select:{id:!0,name:!0,level:!0}},alerts:{where:{status:"open"},select:{id:!0,type:!0,severity:!0,message:!0,createdAt:!0},take:5,orderBy:{createdAt:"desc"}}}})]);return i.Z.json({success:!0,data:(0,d.NR)(c,o,r)},{status:200})})}async function y(e){return(0,d.QO)(e,async t=>{let r=await e.json(),a=l.parse(r);if(await u._.camera.findFirst({where:{name:a.name,zoneId:a.zoneId}}))return i.Z.json({success:!1,error:"Camera already exists"},{status:409});try{let e=await u._.camera.create({data:{...a,createdBy:t.id,updatedBy:t.id}});return i.Z.json({success:!0,data:e},{status:201})}catch(e){return i.Z.json({success:!1,error:"Failed to create camera"},{status:500})}})}async function z(e){return(0,d.QO)(e,async t=>{let{id:r,...a}=await e.json();if(!r)return i.Z.json({success:!1,error:"Camera ID is required"},{status:400});let s=l.parse(a);try{let e=await u._.camera.update({where:{id:r},data:{...s,updatedBy:t.id}});return i.Z.json({success:!0,data:e},{status:200})}catch(e){return i.Z.json({success:!1,error:"Failed to update camera"},{status:500})}})}async function f(e){return(0,d.QO)(e,async()=>{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.Z.json({success:!1,error:"Camera ID is required"},{status:400});try{return await u._.camera.delete({where:{id:r}}),i.Z.json({success:!0,message:"Camera deleted successfully"},{status:200})}catch(e){return i.Z.json({success:!1,error:"Failed to delete camera"},{status:500})}})}let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/security/cameras/route",pathname:"/api/security/cameras",filename:"route",bundlePath:"app/api/security/cameras/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\cameras\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:j,serverHooks:w,headerHooks:x,staticGenerationBailout:v}=g,Z="/api/security/cameras/route";function q(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:j})}},50701:(e,t,r)=>{r.d(t,{XT:()=>i,NR:()=>u,O5:()=>c,c2:()=>m,QO:()=>p});var a=r(78070),s=r(82196),n=r(36929);async function o(e){return await (0,n.getToken)({req:e})}let i=s.z.object({page:s.z.coerce.number().min(1).default(1),limit:s.z.coerce.number().min(1).max(100).default(10),sort:s.z.string().optional(),order:s.z.enum(["asc","desc"]).optional(),search:s.z.string().optional()});function c(e,t){let r=Object.fromEntries(e.nextUrl.searchParams);return t.parse(r)}function u(e,t,r){let{page:a,limit:s}=r;return{items:e,total:t,page:a,limit:s,pages:Math.ceil(t/s)}}function d(e){return e instanceof s.jm?a.Z.json({success:!1,error:"Validation error",data:e.errors},{status:400}):e instanceof Error?a.Z.json({success:!1,error:e.message},{status:500}):a.Z.json({success:!1,error:"An unexpected error occurred"},{status:500})}function l(e,t=400){return a.Z.json({success:!1,error:e},{status:t})}async function p(e,t){try{let r=await o(e);if(!r)return l("Unauthorized",401);return await t(r)}catch(e){return d(e)}}async function m(e,t){try{let r=await o(e);if(!r)return l("Unauthorized",401);if(!r.isAdmin)return l("Forbidden",403);return await t(r)}catch(e){return d(e)}}},40489:(e,t,r)=>{r.d(t,{_:()=>s});let a=require("@prisma/client"),s=global.prisma||new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,929,196],()=>r(8881));module.exports=a})();