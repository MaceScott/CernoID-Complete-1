"use strict";(()=>{var e={};e.id=325,e.ids=[325],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},74409:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>x,originalPathname:()=>v,patchFetch:()=>Z,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>w,staticGenerationAsyncStorage:()=>j,staticGenerationBailout:()=>P});var r={};s.r(r),s.d(r,{DELETE:()=>f,GET:()=>m,POST:()=>y,PUT:()=>z});var n=s(95419),a=s(69108),o=s(99678),i=s(78070),c=s(82196),u=s(40489),d=s(50701);let p=c.z.object({name:c.z.string(),type:c.z.string(),location:c.z.string(),status:c.z.enum(["active","inactive","maintenance"]),zoneId:c.z.string(),settings:c.z.any().optional()}),l=d.XT.extend({name:c.z.string().optional(),type:c.z.string().optional(),location:c.z.string().optional(),status:c.z.enum(["active","inactive","maintenance"]).optional(),zoneId:c.z.string().optional(),zone:c.z.string().optional()});async function m(e){return(0,d.QO)(e,async t=>{let s=(0,d.O5)(e,l),{page:r,limit:n}=s,a={...s.name&&{name:{contains:s.name}},...s.type&&{type:s.type},...s.location&&{location:s.location},...s.status&&{status:s.status},...s.zoneId&&{zoneId:s.zoneId},...s.zone&&{zoneId:s.zone}},[o,c]=await Promise.all([u._.accessPoint.count({where:a}),u._.accessPoint.findMany({where:a,take:n,skip:(r-1)*n,orderBy:{createdAt:"desc"},include:{zone:{select:{id:!0,name:!0,level:!0}}}})]);return i.Z.json({success:!0,data:(0,d.NR)(c,o,s)},{status:200})})}async function y(e){return(0,d.QO)(e,async t=>{let s=await e.json(),r=p.parse(s);if(await u._.accessPoint.findFirst({where:{name:r.name,zoneId:r.zoneId}}))return i.Z.json({success:!1,error:"Access point already exists"},{status:409});try{let e=await u._.accessPoint.create({data:{...r,createdBy:t.id,updatedBy:t.id}});return i.Z.json({success:!0,data:e},{status:201})}catch(e){return i.Z.json({success:!1,error:"Failed to create access point"},{status:500})}})}async function z(e){return(0,d.QO)(e,async t=>{let{id:s,...r}=await e.json();if(!s)return i.Z.json({success:!1,error:"Access point ID is required"},{status:400});let n=p.parse(r);try{let e=await u._.accessPoint.update({where:{id:s},data:{...n,updatedBy:t.id}});return i.Z.json({success:!0,data:e},{status:200})}catch(e){return i.Z.json({success:!1,error:"Failed to update access point"},{status:500})}})}async function f(e){return(0,d.QO)(e,async()=>{let{searchParams:t}=new URL(e.url),s=t.get("id");if(!s)return i.Z.json({success:!1,error:"Access point ID is required"},{status:400});try{return await u._.accessPoint.delete({where:{id:s}}),i.Z.json({success:!0,message:"Access point deleted successfully"},{status:200})}catch(e){return i.Z.json({success:!1,error:"Failed to delete access point"},{status:500})}})}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/security/access-points/route",pathname:"/api/security/access-points",filename:"route",bundlePath:"app/api/security/access-points/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\access-points\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:j,serverHooks:w,headerHooks:x,staticGenerationBailout:P}=g,v="/api/security/access-points/route";function Z(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:j})}},50701:(e,t,s)=>{s.d(t,{XT:()=>i,NR:()=>u,O5:()=>c,c2:()=>m,QO:()=>l});var r=s(78070),n=s(82196),a=s(36929);async function o(e){return await (0,a.getToken)({req:e})}let i=n.z.object({page:n.z.coerce.number().min(1).default(1),limit:n.z.coerce.number().min(1).max(100).default(10),sort:n.z.string().optional(),order:n.z.enum(["asc","desc"]).optional(),search:n.z.string().optional()});function c(e,t){let s=Object.fromEntries(e.nextUrl.searchParams);return t.parse(s)}function u(e,t,s){let{page:r,limit:n}=s;return{items:e,total:t,page:r,limit:n,pages:Math.ceil(t/n)}}function d(e){return e instanceof n.jm?r.Z.json({success:!1,error:"Validation error",data:e.errors},{status:400}):e instanceof Error?r.Z.json({success:!1,error:e.message},{status:500}):r.Z.json({success:!1,error:"An unexpected error occurred"},{status:500})}function p(e,t=400){return r.Z.json({success:!1,error:e},{status:t})}async function l(e,t){try{let s=await o(e);if(!s)return p("Unauthorized",401);return await t(s)}catch(e){return d(e)}}async function m(e,t){try{let s=await o(e);if(!s)return p("Unauthorized",401);if(!s.isAdmin)return p("Forbidden",403);return await t(s)}catch(e){return d(e)}}},40489:(e,t,s)=>{s.d(t,{_:()=>n});let r=require("@prisma/client"),n=global.prisma||new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,206,929,196],()=>s(74409));module.exports=r})();