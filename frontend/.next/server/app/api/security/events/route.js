"use strict";(()=>{var e={};e.id=16,e.ids=[16],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},39951:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>x,patchFetch:()=>b,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var n={};r.r(n),r.d(n,{GET:()=>m,POST:()=>z});var a=r(95419),i=r(69108),o=r(99678),s=r(78070),u=r(82196),c=r(40489),l=r(76971),p=r(50701);let d=p.XT.extend({startDate:u.z.string().optional(),endDate:u.z.string().optional(),type:u.z.string().optional(),location:u.z.string().optional(),severity:u.z.enum(["low","medium","high"]).optional(),personId:u.z.string().optional()});async function m(e){return(0,p.QO)(async()=>{let{searchParams:t}=new URL(e.url),r=(0,p.O5)(t,d),n={...r.startDate&&{timestamp:{gte:new Date(r.startDate)}},...r.endDate&&{timestamp:{...r.startDate&&{gte:new Date(r.startDate)}||{},lte:new Date(r.endDate)}},...r.type&&{type:r.type},...r.location&&{location:r.location},...r.severity&&{severity:r.severity},...r.personId&&{personId:r.personId}},[a,i]=await Promise.all([c._.securityEvent.count({where:n}),c._.securityEvent.findMany({where:n,orderBy:{timestamp:"desc"},take:r.limit||10,skip:r.offset||0,include:{person:{select:{id:!0,name:!0,email:!0}}}})]);return(0,p.NR)(i,a,r.limit||10,r.offset||0)})}async function z(e){return(0,p.QO)(async t=>{if(!t)throw Error("User is required");let r=await e.json(),n=l.O.parse(r),a=await c._.securityEvent.create({data:{...n,createdBy:t.id},include:{person:{select:{id:!0,name:!0,email:!0}}}});return s.Z.json(a,{status:201})})}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/security/events/route",pathname:"/api/security/events",filename:"route",bundlePath:"app/api/security/events/route"},resolvedPagePath:"C:\\Users\\maces\\CernoID-Complete-1\\frontend\\app\\api\\security\\events\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:v,headerHooks:h,staticGenerationBailout:w}=g,x="/api/security/events/route";function b(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:f})}},50701:(e,t,r)=>{r.d(t,{XT:()=>s,NR:()=>c,O5:()=>u,c2:()=>m,QO:()=>d});var n=r(78070),a=r(82196),i=r(36929);async function o(e){return await (0,i.getToken)({req:e})}let s=a.z.object({page:a.z.coerce.number().min(1).default(1),limit:a.z.coerce.number().min(1).max(100).default(10),sort:a.z.string().optional(),order:a.z.enum(["asc","desc"]).optional(),search:a.z.string().optional()});function u(e,t){let r=Object.fromEntries(e.nextUrl.searchParams);return t.parse(r)}function c(e,t,r){let{page:n,limit:a}=r;return{items:e,total:t,page:n,limit:a,pages:Math.ceil(t/a)}}function l(e){return e instanceof a.jm?n.Z.json({success:!1,error:"Validation error",data:e.errors},{status:400}):e instanceof Error?n.Z.json({success:!1,error:e.message},{status:500}):n.Z.json({success:!1,error:"An unexpected error occurred"},{status:500})}function p(e,t=400){return n.Z.json({success:!1,error:e},{status:t})}async function d(e,t){try{let r=await o(e);if(!r)return p("Unauthorized",401);return await t(r)}catch(e){return l(e)}}async function m(e,t){try{let r=await o(e);if(!r)return p("Unauthorized",401);if(!r.isAdmin)return p("Forbidden",403);return await t(r)}catch(e){return l(e)}}},76971:(e,t,r)=>{r.d(t,{Iy:()=>i,O:()=>a});var n=r(82196);let a=n.z.object({id:n.z.string().optional(),type:n.z.string(),severity:n.z.enum(["low","medium","high"]),message:n.z.string(),timestamp:n.z.string().datetime().optional(),cameraId:n.z.string().optional(),zoneId:n.z.string().optional(),userId:n.z.string().optional(),metadata:n.z.record(n.z.unknown()).optional()}),i=n.z.object({id:n.z.string().optional(),name:n.z.string(),description:n.z.string().optional(),type:n.z.enum(["role","zone","feature"]),value:n.z.string(),metadata:n.z.record(n.z.unknown()).optional()});n.z.object({id:n.z.string().optional(),name:n.z.string(),description:n.z.string().optional(),level:n.z.number().min(0).max(10),parent_id:n.z.string().optional(),metadata:n.z.record(n.z.unknown()).optional(),cameras:n.z.array(n.z.string()).optional(),allowedRoles:n.z.array(n.z.string()).optional(),allowedUsers:n.z.array(n.z.string()).optional(),schedules:n.z.array(n.z.object({days:n.z.array(n.z.number().min(0).max(6)),start:n.z.string(),end:n.z.string()})).optional()})},40489:(e,t,r)=>{r.d(t,{_:()=>a});let n=require("@prisma/client"),a=global.prisma||new n.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206,929,196],()=>r(39951));module.exports=n})();